!function(t){var e={};function n(i){if(e[i])return e[i].exports;var o=e[i]={i:i,l:!1,exports:{}};return t[i].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)n.d(i,o,function(e){return t[e]}.bind(null,o));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s=13)}([function(t,e,n){"use strict";(function(t){var i=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(7));e.CatchReportAsyncException=function(t,e,n){const o=n.value;return n.value=function(...t){return i(this,void 0,void 0,(function*(){try{return yield o.apply(this,t)}catch(e){throw a&&a.error(e,t),e}}))},n},e.CatchReportException=function(t,e,n){const i=n.value;return n.value=function(...t){try{return i.apply(this,t)}catch(e){throw a&&a.error(e,t),e}},n};const s={accessToken:"ae4171ca3aad492887231362eba50499",captureUncaught:!1,captureUnhandledRejections:!1,payload:{environment:r.default.environment}},a=t&&t.rollbar?new t.rollbar(s):null}).call(this,n(16))},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(2)),i(n(15)),i(n(5)),i(n(6))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.AnonymousStudentProfileUpdated="anonymous-student-profile-updated",t.AnonymousStudentProfileSynced="anonymous-student-profile-synced"}(e.EventType||(e.EventType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(2);class o{constructor(t,e,n){this.timestamp=t,this.state=e,this.changes=n}}e.AnonymousStudentProfileUpdated=o,o.EventType=i.EventType.AnonymousStudentProfileUpdated},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.StudentRepositoryState=class{constructor(t,e,n){this.eventAggregationService=t,this.sessionService=e,this.studentRepository=n}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.IDENTITY="identity",t.EMAIL="email",t.NAME="name",t.FIRST_NAME="first_name",t.LAST_NAME="last_name",t.GENDER="gender",t.BIRTH_DATE="birth_date",t.TELEPHONE="telephone",t.START_PERIOD="start_period",t.FUNDING_TYPE="funding_type",t.STUDY_LEVEL="study_level",t.PREFERRED_STUDY_LEVEL="preferred_study_level",t.RESIDENCE_COUNTRY_ID="residence_country_id",t.NATIONALITY_COUNTRY_ID="nationality_country_id",t.STUDY_COUNTRY_ID="study_country_id",t.REGISTRATION_IP="registration_ip",t.REGISTRATION_PORTAL_TYPE="registration_portal_type",t.WORK_EXPERIENCE="work_experience",t.PROFICIENCY_TYPE="proficiency_type",t.PROFICIENCY_TEST="proficiency_test",t.PROFICIENCY_SCORE="proficiency_score",t.IELTS="ielts",t.CAE="cae",t.FCE="fce",t.TOEFL_IBT="toefl_ibt",t.TOEFL_PBT="toefl_pbt",t.PTE="pte",t.SELF_ASSESSMENT_PROFICIENCY="self_assessment_proficiency",t.INITIAL_REGISTRATION_PLATFORM="initial_registration_platform",t.EMAILING_OTHER="emailing_other",t.EMAILING_FAVOURITES="emailing_favourites",t.EMAILING_SCHOLARSHIPS="emailing_scholarships",t.EMAILING_UPDATES="emailing_updates",t.LAST_LOGIN="last_login",t.LAST_LOGIN_UTC="last_login_utc",t.DATE_CREATED="date_created",t.DATE_CREATED_UTC="date_created_utc",t.LOGINS="logins",t.DISCIPLINES="disciplines",t.INTERESTS_COUNTRIES="interests_countries",t.INTERESTS_DISCIPLINES="interests_disciplines",t.EMAIL_UNSUBSCRIBE_TOKEN="emailUnsubscribeToken",t.GDPR_ACCEPTED="gdpr_accepted",t.ORIGIN_ORGANISATION_ID="origin_organisation_id",t.GPA="gpa",t.LIVING_BUDGET="living_budget",t.TUITION_BUDGET="tuition_budget",t.SEEN_COMPARISON_TUTORIAL="seen_comparison_tutorial",t.ACCOMPLISHMENTS="accomplishments"}(e.StudentField||(e.StudentField={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.PENDING=0]="PENDING",t[t.ONLINE=1]="ONLINE",t[t.OFFLINE=2]="OFFLINE"}(e.StudentRepositoryStateType||(e.StudentRepositoryStateType={}))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={environment:"prd",STUDENTAPI_BASE_URL:"https://studentapi.prtl.co"}},function(t,e,n){"use strict";function i(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),i(n(9)),i(n(3))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(2);class o{constructor(t,e){this.timestamp=t,this.state=e}}e.AnonymousStudentProfileSynced=o,o.EventType=i.EventType.AnonymousStudentProfileSynced},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(9),o=n(3);e.AnonymousStudentEventBroadcaster=class{constructor(t){this.eventAggregationService=t}broadcastStudentProfileSyncedEvent(t){this.eventAggregationService.publishTo(i.AnonymousStudentProfileSynced.EventType,t)}broadcastProfileUpdatedEvent(t){this.eventAggregationService.publishTo(o.AnonymousStudentProfileUpdated.EventType,t)}}},function(t,e,n){"use strict";var i=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=n(24),r=n(5),s=n(6),a=n(3);e.LocalStudentClient=class{constructor(t,e,n=null){this.storageKey=t,this.storageTTL=e,this.anonymousStudentEventBroadcaster=n,this.localStorage=o.DataStorage}cleanUp(){return i(this,void 0,void 0,(function*(){this.localStorage.remove(this.storageKey)}))}getData(t){return i(this,void 0,void 0,(function*(){const e=this.retrieveDataFromLocalStorage(),n={};return t.forEach(t=>{const i=e[t];void 0!==i&&(n[t]=null!==i?i:void 0)}),n}))}setData(t){return i(this,void 0,void 0,(function*(){const e=this.retrieveDataFromLocalStorage();t=Object.assign(Object.assign({},e),t),Object.keys(t).forEach(e=>{null===t[e]&&(t[e]=void 0)}),this.setDataInLocalStorage(t),this.broadcastChanges(t)}))}addDisciplines(t){return i(this,void 0,void 0,(function*(){this.addToIdListInLocalStorage(r.StudentField.DISCIPLINES,t)}))}addInterest(t,e){return i(this,void 0,void 0,(function*(){this.addToIdListInLocalStorage(t,e)}))}removeDisciplines(t){return i(this,void 0,void 0,(function*(){this.removeFromIdListInLocalStorage(r.StudentField.DISCIPLINES,t)}))}removeInterest(t,e){return i(this,void 0,void 0,(function*(){this.removeFromIdListInLocalStorage(t,e)}))}retrieveDataFromLocalStorage(){const t=this.localStorage.retrieve(this.storageKey);return t?JSON.parse(t):{}}setDataInLocalStorage(t){Object.keys(t).forEach(e=>{void 0===t[e]&&(t[e]=null)}),this.localStorage.store(this.storageKey,JSON.stringify(t),this.storageTTL)}addToIdListInLocalStorage(t,e){const n=this.retrieveDataFromLocalStorage(),i=new Set(n[t]);e.forEach(t=>{i.add(t)}),n[t]=Array.from(i),this.setDataInLocalStorage(n),this.broadcastChanges({[t]:n[t]})}removeFromIdListInLocalStorage(t,e){const n=this.retrieveDataFromLocalStorage(),i=new Set(n[t]);e.forEach(t=>{i.delete(t)}),n[t]=Array.from(i),this.setDataInLocalStorage(n),this.broadcastChanges({[t]:n[t]})}broadcastChanges(t){if(!this.anonymousStudentEventBroadcaster)return;const e=new a.AnonymousStudentProfileUpdated(new Date,s.StudentRepositoryStateType.OFFLINE,t);this.anonymousStudentEventBroadcaster.broadcastProfileUpdatedEvent(e)}}},function(t,e,n){"use strict";var i=function(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s},o=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),a=n(10),u=n(26),c=n(11),d=n(27),l=n(4);class p extends l.StudentRepositoryState{constructor(t,e,n){super(t,e,n),this.eventAggregationService=t,this.sessionService=e,this.studentRepository=n,this.studentClient=null}constructStudentClient(){const t=new a.AnonymousStudentEventBroadcaster(this.eventAggregationService),e=new c.LocalStudentClient("AnonymousStudent/Online",3600),n=new d.StudentAPIClient(this.sessionService);return new u.CachedStudentClient(n,e,this.eventAggregationService,t)}initialize(){this.studentClient=this.constructStudentClient(),this.eventAggregationService.subscribeToSessionDestroyedEvent(this)}notify(t){return r(this,void 0,void 0,(function*(){yield this.studentClient.clearCache()}))}setStudentData(t){return r(this,void 0,void 0,(function*(){return this.studentClient.setData(t)}))}getStudentData(t){return r(this,void 0,void 0,(function*(){return this.studentClient.getData(t)}))}addDisciplines(t){return r(this,void 0,void 0,(function*(){return this.studentClient.addDisciplines(t)}))}removeDisciplines(t){return r(this,void 0,void 0,(function*(){return this.studentClient.removeDisciplines(t)}))}addInterest(t,e){return r(this,void 0,void 0,(function*(){return this.studentClient.addInterest(t,e)}))}removeInterest(t,e){return r(this,void 0,void 0,(function*(){return this.studentClient.removeInterest(t,e)}))}}i([s.CatchReportException,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],p.prototype,"initialize",null),e.OnlineStudentRepositoryState=p},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=n(14),o=new(n(17).StudentRepository)(window.EventAggregationService,window.SessionService);window.AnonymousStudent=new i.AnonymousStudentService(o),o.initialize()},function(t,e,n){"use strict";var i=function(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s},o=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});n(1);const s=n(0);class a{constructor(t){this.studentRepository=t}setStudentData(t){return r(this,void 0,void 0,(function*(){yield this.studentRepository.setStudentData(t)}))}getStudentData(t){return r(this,void 0,void 0,(function*(){return this.studentRepository.getStudentData(t)}))}getStudentDataCompleteness(t){return r(this,void 0,void 0,(function*(){return this.studentRepository.getStudentDataCompleteness(t)}))}addDisciplines(t){return r(this,void 0,void 0,(function*(){return this.studentRepository.addDisciplines(t)}))}removeDisciplines(t){return r(this,void 0,void 0,(function*(){return this.studentRepository.removeDisciplines(t)}))}addInterest(t,e){return r(this,void 0,void 0,(function*(){return this.studentRepository.addInterest(t,e)}))}removeInterest(t,e){return r(this,void 0,void 0,(function*(){return this.studentRepository.removeInterest(t,e)}))}setName(t){return r(this,void 0,void 0,(function*(){return this.studentRepository.setName(t)}))}setGPA(t,e){return r(this,void 0,void 0,(function*(){return this.studentRepository.setGPA(t,e)}))}}i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],a.prototype,"setStudentData",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],a.prototype,"getStudentData",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],a.prototype,"getStudentDataCompleteness",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],a.prototype,"addDisciplines",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Array]),o("design:returntype",Promise)],a.prototype,"removeDisciplines",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[String,Array]),o("design:returntype",Promise)],a.prototype,"addInterest",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[String,Array]),o("design:returntype",Promise)],a.prototype,"removeInterest",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[String]),o("design:returntype",Promise)],a.prototype,"setName",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[String,Object]),o("design:returntype",Promise)],a.prototype,"setGPA",null),e.AnonymousStudentService=a},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.COUNTRY="interests_countries",t.DISCIPLINE="interests_disciplines"}(e.InterestType||(e.InterestType={}))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";var i=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const o=n(18);e.StudentRepository=class{constructor(t,e){this.state=this.createPendingStudentRepositoryState(t,e)}initialize(){this.state.initialize()}createPendingStudentRepositoryState(t,e){return new o.PendingStudentRepositoryState(t,e,this)}setStudentData(t){return i(this,void 0,void 0,(function*(){yield this.state.setStudentData(t)}))}getStudentData(t){return i(this,void 0,void 0,(function*(){const e=yield this.state.getStudentData(t),n=Object.keys(e);return t.forEach(t=>{n.includes(t)||(e[t]=void 0)}),e}))}getStudentDataCompleteness(t){return i(this,void 0,void 0,(function*(){const e=yield this.getStudentData(t);return t.filter(t=>void 0!==e[t]).length/t.length}))}addDisciplines(t){return i(this,void 0,void 0,(function*(){return this.state.addDisciplines(t)}))}removeDisciplines(t){return i(this,void 0,void 0,(function*(){return this.state.removeDisciplines(t)}))}addInterest(t,e){return i(this,void 0,void 0,(function*(){return this.state.addInterest(t,e)}))}removeInterest(t,e){return i(this,void 0,void 0,(function*(){return this.state.removeInterest(t,e)}))}setGPA(t,e){return i(this,void 0,void 0,(function*(){let n={gpa:{[t]:e,current_type:t}};return this.setStudentData(n)}))}setName(t){return i(this,void 0,void 0,(function*(){let e,n,i=t.indexOf(" ",0);-1!==i?(e=t.substring(0,i),n=t.substring(i).trim()):(e=t,n=void 0);let o={name:t,first_name:e,last_name:n};return this.setStudentData(o)}))}updateState(t){this.state=t}}},function(t,e,n){"use strict";var i=function(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s},o=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=n(0),a=n(19),u=n(20),c=n(12),d=n(4);class l extends d.StudentRepositoryState{constructor(t,e,n){super(t,e,n),this.lock=new a.Deferred}initialize(){this.sessionService.isReady?this.onSessionServiceReady(this.sessionService):this.eventAggregationService.subscribeToSessionServiceReadyEvent(this)}notify(t){return r(this,void 0,void 0,(function*(){yield this.onSessionServiceReady(t)}))}setStudentData(t){return r(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.setStudentData(t)}))}getStudentData(t){return r(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.getStudentData(t)}))}addDisciplines(t){return r(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.addDisciplines(t)}))}removeDisciplines(t){return r(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.removeDisciplines(t)}))}addInterest(t,e){return r(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.addInterest(t,e)}))}removeInterest(t,e){return r(this,void 0,void 0,(function*(){return yield this.lock.untilOpen(),this.state.removeInterest(t,e)}))}onSessionServiceReady(t){return r(this,void 0,void 0,(function*(){const e=yield t.getSession(),n=this.createOnlineStudentRepositoryState(t),i=this.createOfflineStudentRepositoryState(t);this.state=null===e?i:n,this.state.initialize(),this.lock.open(),this.studentRepository.updateState(this.state),this.state===n&&(yield i.syncData(n))}))}createOnlineStudentRepositoryState(t){return new c.OnlineStudentRepositoryState(this.eventAggregationService,t,this.studentRepository)}createOfflineStudentRepositoryState(t){return new u.OfflineStudentRepositoryState(this.eventAggregationService,t,this.studentRepository)}}i([s.CatchReportException,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],l.prototype,"initialize",null),i([s.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],l.prototype,"notify",null),e.PendingStudentRepositoryState=l},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Deferred=class{constructor(){this.isOpen=!1,this.isOpeningPromisePresent=!1,this.isReadyCallback=()=>{}}open(){this.isOpen=!0,this.isReadyCallback(),this.reset()}close(){this.isOpen=!1,this.reset()}reset(){this.isReadyCallback=()=>{},this.isOpeningPromisePresent=!1}untilOpen(){return this.isOpeningPromisePresent?this.isOpeningPromisePresent:this.isOpeningPromisePresent=new Promise(t=>{this.isOpen?t():this.isReadyCallback=t})}}},function(t,e,n){"use strict";var i=function(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s},o=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=n(21),a=n(1),u=n(8),c=n(0),d=n(10),l=n(11),p=n(12),f=n(4);class h extends f.StudentRepositoryState{constructor(t,e,n){super(t,e,n),this.eventAggregationService=t,this.sessionService=e,this.studentRepository=n;const i=new d.AnonymousStudentEventBroadcaster(t);this.anonymousStudentEventBroadcaster=i,this.studentClient=new l.LocalStudentClient("AnonymousStudent/Offline",2629800,i)}initialize(){this.eventAggregationService.subscribeToSessionCreatedEvent(this)}notify(t){return r(this,void 0,void 0,(function*(){yield this.onSessionCreatedEvent(t.session)}))}onSessionCreatedEvent(t){return r(this,void 0,void 0,(function*(){const t=this.createNewOnlineStudentRepositoryState();t.initialize(),this.studentRepository.updateState(t),yield this.syncData(t),this.broadcastSyncEvent()}))}createNewOnlineStudentRepositoryState(){return new p.OnlineStudentRepositoryState(this.eventAggregationService,this.sessionService,this.studentRepository)}syncData(t){return r(this,void 0,void 0,(function*(){yield this.saveOldDataOnNewState(t),yield this.studentClient.cleanUp()}))}saveOldDataOnNewState(t){return r(this,void 0,void 0,(function*(){const e=this.getAllStudentFields(),n=yield this.getStudentData(e),i=this.getFieldsToSync(n);if(0===i.length)return;const o={};i.forEach(t=>{o[t]=n[t]}),yield t.setStudentData(o)}))}broadcastSyncEvent(){const t=new u.AnonymousStudentProfileSynced(new Date,a.StudentRepositoryStateType.ONLINE);this.anonymousStudentEventBroadcaster.broadcastStudentProfileSyncedEvent(t)}getFieldsToSync(t){return Object.keys(t).filter(e=>void 0!==t[e])}getAllStudentFields(){let t=[];return Object.keys(a.StudentField).forEach(e=>{t.push(a.StudentField[e])}),t}setStudentData(t){return r(this,void 0,void 0,(function*(){yield this.studentClient.setData(t)}))}getStudentData(t){return r(this,void 0,void 0,(function*(){return this.studentClient.getData(t)}))}addDisciplines(t){return r(this,void 0,void 0,(function*(){return this.studentClient.addDisciplines(t)}))}removeDisciplines(t){return r(this,void 0,void 0,(function*(){return this.studentClient.removeDisciplines(t)}))}addInterest(t,e){return r(this,void 0,void 0,(function*(){return this.studentClient.addInterest(t,e)}))}removeInterest(t,e){return r(this,void 0,void 0,(function*(){return this.studentClient.removeInterest(t,e)}))}}i([c.CatchReportException,o("design:type",Function),o("design:paramtypes",[]),o("design:returntype",void 0)],h.prototype,"initialize",null),i([c.CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[s.SessionCreatedEvent]),o("design:returntype",Promise)],h.prototype,"notify",null),e.OfflineStudentRepositoryState=h},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(22))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}(n(23))},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.SessionCreatedEvent=class{constructor(t){this.timestamp=new Date,this.session=t}}},function(t,e,n){"use strict";var i=new(n(25).DataStorage);i.init(),t.exports={DataStorage:i}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=function(){function t(){this.enabled=!1}return t.prototype.init=function(){try{if("undefined"==typeof localStorage)return void(this.enabled=!1);localStorage.setItem("test","dummy value"),localStorage.removeItem("test"),this.enabled=!0}catch(t){this.enabled=!1}},t.prototype.store=function(t,e,n){if(void 0===n&&(n=1800),this.enabled){var i=new Date,o={expires:i.setSeconds(i.getSeconds()+n),data:e};localStorage[t]=JSON.stringify(o)}else document.cookie=t+"="+e+";expires="+n/86400;return!0},t.prototype.retrieve=function(t){if(this.enabled){var e=localStorage[t];try{e=JSON.parse(e)}catch(t){e={}}if(!e||!e.hasOwnProperty("expires")||!e.hasOwnProperty("data"))return"";var n=parseInt(e.expires,10);return isNaN(n)&&(n=0),new Date>=new Date(n)?(localStorage[t]=null,""):e.data}return this.getCookie(t)},t.prototype.remove=function(t){this.enabled?delete localStorage[t]:document.cookie=t+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},t.prototype.update=function(t,e,n){var i=this.retrieve(t);return"object"!=typeof i&&(i={}),i=Object.assign({},i,e),this.store(t,i,n),i},t.prototype.getCookie=function(t){var e=RegExp(t+"=.[^;]*"),n=document.cookie.match(e);return n?n[0].split("=")[1]:""},t}();e.DataStorage=i},function(t,e,n){"use strict";var i=function(t,e,n,i){var o,r=arguments.length,s=r<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,n,i);else for(var a=t.length-1;a>=0;a--)(o=t[a])&&(s=(r<3?o(s):r>3?o(e,n,s):o(e,n))||s);return r>3&&s&&Object.defineProperty(e,n,s),s},o=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},r=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0});const s=n(1),a=n(8);class u{constructor(t,e,n,i){this.studentAPIClient=t,this.localStudentClient=e,this.eventAggregationService=n,this.anonymousStudentEventBroadcaster=i,this.eventAggregationService.subscribeToWebSocketEvent("StudentProfileChanged",this)}notify(t){return r(this,void 0,void 0,(function*(){if("StudentProfileChanged"!==t.eventType)return;const e=this.transformStudentProfileChangedEventIntoStudentData(t),n=new Date(t.eventTimestamp);yield this.updateDataFromEvent(e);const i=new a.AnonymousStudentProfileUpdated(n,s.StudentRepositoryStateType.ONLINE,e);this.anonymousStudentEventBroadcaster.broadcastProfileUpdatedEvent(i)}))}isForceUpdateField(t){return[s.StudentField.DISCIPLINES,s.StudentField.INTERESTS_COUNTRIES,s.StudentField.INTERESTS_DISCIPLINES,s.StudentField.TUITION_BUDGET,s.StudentField.LIVING_BUDGET].includes(t)}updateDataFromEvent(t){return r(this,void 0,void 0,(function*(){const e=[];Object.keys(t).forEach(n=>{(t[n]instanceof Object||this.isForceUpdateField(n))&&e.push(n)});const n=yield this.studentAPIClient.getData(e);yield this.localStudentClient.setData(Object.assign(Object.assign({},t),n))}))}transformStudentProfileChangedEventIntoStudentData(t){const e={};return t.updated&&Object.keys(t.updated).forEach(n=>{e[n]=t.updated[n]}),t.deleted&&Object.keys(t.deleted).forEach(t=>{e[t]=void 0}),e}addDisciplines(t){return r(this,void 0,void 0,(function*(){yield this.studentAPIClient.addDisciplines(t),yield this.localStudentClient.addDisciplines(t)}))}addInterest(t,e){return r(this,void 0,void 0,(function*(){yield this.studentAPIClient.addInterest(t,e),yield this.localStudentClient.addInterest(t,e)}))}getData(t){return r(this,void 0,void 0,(function*(){const e=yield this.localStudentClient.getData(t),n=Object.keys(e),i=t.filter(t=>!n.includes(t));if(i.length>0){const t=yield this.studentAPIClient.getData(i);return yield this.localStudentClient.setData(t),Object.assign(Object.assign({},e),t)}return e}))}removeDisciplines(t){return r(this,void 0,void 0,(function*(){yield this.studentAPIClient.removeDisciplines(t),yield this.localStudentClient.removeDisciplines(t)}))}removeInterest(t,e){return r(this,void 0,void 0,(function*(){yield this.studentAPIClient.removeInterest(t,e),yield this.localStudentClient.removeInterest(t,e)}))}setData(t){return r(this,void 0,void 0,(function*(){yield this.studentAPIClient.setData(t),yield this.localStudentClient.setData(t)}))}clearCache(){return this.localStudentClient.cleanUp()}}i([n(0).CatchReportAsyncException,o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",Promise)],u.prototype,"notify",null),e.CachedStudentClient=u},function(t,e,n){"use strict";var i=function(t,e,n,i){return new(n||(n=Promise))((function(o,r){function s(t){try{u(i.next(t))}catch(t){r(t)}}function a(t){try{u(i.throw(t))}catch(t){r(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((i=i.apply(t,e||[])).next())}))},o=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});const r=o(n(7));e.StudentAPIClient=class{constructor(t){this.sessionService=t,this.requestMap=new Map}get fetch(){return fetch}getData(t){return i(this,void 0,void 0,(function*(){const e=this.getActiveDataRequestsAndFieldsToRequest(t),n=e.activeDataRequests,i=e.studentFieldsToRequest;return i.length>0&&n.push(this.retrieveStudentFields(i)),this.mergeStudentDataResponses(yield Promise.all(n))}))}patchData(t){return i(this,void 0,void 0,(function*(){yield fetch("".concat(r.default.STUDENTAPI_BASE_URL,"/data"),{method:"PATCH",headers:{Authorization:yield this.getAccessToken()},body:JSON.stringify(t)})}))}setData(t){return this.patchData(t)}addDisciplines(t){return this.patchData({disciplines_add:t})}addInterest(t,e){return this.patchData({["".concat(t,"_add")]:e})}removeDisciplines(t){return this.patchData({disciplines_remove:t})}removeInterest(t,e){return this.patchData({["".concat(t,"_remove")]:e})}getActiveDataRequestsAndFieldsToRequest(t){const e=[],n=[];return t.forEach(t=>{const i=this.requestMap.get(t);i?e.push(i):n.push(t)}),{activeDataRequests:e,studentFieldsToRequest:n}}retrieveStudentFields(t){return i(this,void 0,void 0,(function*(){const e=this.requestStudentData(t);t.forEach(t=>{this.requestMap.set(t,e)});const n=yield e;return t.forEach(t=>{this.requestMap.delete(t)}),n}))}mergeStudentDataResponses(t){let e={};return t.forEach(t=>{e=Object.assign(Object.assign({},e),t)}),e}requestStudentData(t){return i(this,void 0,void 0,(function*(){const e=yield fetch("".concat(r.default.STUDENTAPI_BASE_URL,"/data?scope=").concat(t.join(",")),{headers:{Authorization:yield this.getAccessToken()}});if(!e.ok)throw new Error("Failed to retrieve data from StudentAPI");const n=yield e.json();return Object.keys(n).forEach(t=>{null===n[t]&&(n[t]=void 0)}),n}))}getAccessToken(){return i(this,void 0,void 0,(function*(){return(yield this.sessionService.getSession()).getAccessToken()}))}}}]);