!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist/",n(n.s=145)}([function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(40)),r(n(4))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={stage:"prd",studentApiBaseUrl:"https://studentapi.prtl.co",hubUrl:"https://studentjs.studyportals.com/storageHub.html?v2",serviceLayerBaseUrl:"https://reflectorjwt.prtl.co",wishlistServiceBaseUrl:"https://decisionmakingapi.prtl.co",tokenServiceBaseUrl:"https://tokens.prtl.co",wssEndpoint:"wss://studentwebsocketservice.prtl.co/v1",allowedOrigins:[/((www)|(cypress\.rc)|([0-9]{4,16}(-bob)?\.rc))\.mastersportal.((com)|(fyi))/,/((www)|(cypress\.rc)|([0-9]{4,16}(-bob)?\.rc))\.bachelorsportal\.((com)|(fyi))/,/((www)|(cypress\.rc)|([0-9]{4,16}(-bob)?\.rc))\.phdportal\.((com)|(fyi))/,/((www)|(cypress\.rc)|([0-9]{4,16}(-bob)?\.rc))\.preparationcoursesportal\.((com)|(fyi))/,/((www)|(cypress\.rc)|([0-9]{4,16}(-bob)?\.rc))\.distancelearningportal\.((com)|(fyi))/,/((www)|(cypress\.rc)|([0-9]{4,16}(-bob)?\.rc))\.shortcoursesportal\.((com)|(fyi))/,/personalitytest\.studyportals\.com/,/countrytest\.studyportals\.com/,/scholarship\.mastersportal\.com/]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e),this.name="WishlistException"}}t.WishlistException=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.callback=e}return e.prototype.notify=function(e){try{this.callback(e)}catch(e){}},e}();t.CallbackSubscriber=r},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(44)),r(n(25)),r(n(27)),r(n(28))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t){return fetch(e,t)}},function(e,t,n){"use strict";(function(e){var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(1);t.CatchReportAsyncException=function(e,t,n){var s=n.value;return n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,s.apply(this,e)];case 1:return[2,n.sent()];case 2:throw t=n.sent(),u&&u.error(t,e),t;case 3:return[2]}}))}))},n},t.CatchReportException=function(e,t,n){var r=n.value;return n.value=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];try{return r.apply(this,e)}catch(t){throw u&&u.error(t,e),t}},n};var o={accessToken:"a0e7bd5089784ef6b69e99066c272f2f",captureUncaught:!1,captureUnhandledRejections:!1,payload:{environment:s.default.stage}},u=e&&e.rollbar?new e.rollbar(o):null}).call(this,n(123))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Credentials=function(e,t){this.accessToken=e,this.refreshToken=t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RefreshTokenError=function(e){this.message=e}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.RestCallType||(t.RestCallType={})).GET="GET",r.POST="POST",r.PATCH="PATCH",r.OPTIONS="OPTIONS",r.DELETE="DELETE"},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(56)),r(n(29)),r(n(62))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(4);t.BaseWishlistCommandHandler=class{constructor(e){this.wishlistRepository=e,this.wishlistStateValidator=new i.WishlistStateValidator}getWishlist(e,t){return r(this,void 0,void 0,(function*(){const n=yield this.wishlistRepository.retrieveByUserId(e);if(null===n)throw new i.WishlistNotFound(e);return this.wishlistStateValidator.validate(n,t),n}))}}},function(e,t,n){"use strict";var r=new(n(32).DataStorage);r.init(),e.exports={DataStorage:r}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(79),s=function(){function e(){}return e.translateSerializedWishlist=function(t){var n=new r.Wishlist(t.userId);return t.favourites.forEach((function(t){var i=e.createStudy(t),s=new Date(t.dateAdded),o=new r.Favourite(i,s);n.addFavourite(o)})),n},e.createStudy=function(t){var n=t.study,i=new r.Study(n.id);return i.title=n.title,i.isPublic=n.isPublic,i.degreeType=n.degreeType,i.duration=n.duration,i.logo=n.logo,i.tuitionFees=n.tuitionFees,i.applicationDeadlines=e.parseDeadlines(n.applicationDeadlines),i.level=n.level,i.isPremium=n.isPremium,i.Venue=n.venue,i.University=n.university,i.referralLink=e.parseReferralLink(n.referralLink),i},e.parseReferralLink=function(e){if(null==e)return null;var t=e.tracking,n=new i.Tracking(t.googleAnalyticsTracking,t.action,t.type,t.id,t.description,t.label,t.extra);return new i.TrackedLink(n,e.url,e.description)},e.parseDeadlines=function(e){return null==e?null:e.map((function(e){return e.start=new Date(e.start),e.deadline&&(e.deadline=new Date(e.deadline)),e}))},e}();t.WishlistFactory=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(21);t.Actions=r.default;var i=n(22);t.Labels=i.default;var s=n(23);t.Tags=s.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.isOpen=!1,this.isOpeningPromisePresent=!1,this.isReadyCallback=function(){}}return e.prototype.open=function(){this.isOpen=!0,this.isReadyCallback(),this.reset()},e.prototype.close=function(){this.isOpen=!1,this.reset()},e.prototype.reset=function(){this.isReadyCallback=function(){},this.isOpeningPromisePresent=!1},e.prototype.untilOpen=function(){var e=this;return this.isOpeningPromisePresent?this.isOpeningPromisePresent:this.isOpeningPromisePresent=new Promise((function(t){e.isOpen?t():e.isReadyCallback=t}))},e}();t.Deferred=r},function(e,t,n){e.exports={CrossStorageClient:n(17),CrossStorageHub:n(18)}},function(e,t,n){!function(n){function r(e,t){var n;t=t||{},this._id=r._generateUUID(),this._promise=t.promise||Promise,this._frameId=t.frameId||"CrossStorageClient-"+this._id,this._origin=r._getOrigin(e),this._requests={},this._connected=!1,this._closed=!1,this._count=0,this._timeout=t.timeout||5e3,this._listener=null,this._installListener(),t.frameId&&(n=document.getElementById(t.frameId)),n&&this._poll(),n=n||this._createFrame(e),this._hub=n.contentWindow}r.frameStyle={display:"none",position:"absolute",top:"-999px",left:"-999px"},r._getOrigin=function(e){var t;return(t=document.createElement("a")).href=e,t.host||(t=window.location),((t.protocol&&":"!==t.protocol?t.protocol:window.location.protocol)+"//"+t.host).replace(/:80$|:443$/,"")},r._generateUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))},r.prototype.onConnect=function(){var e=this;return this._connected?this._promise.resolve():this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):(this._requests.connect||(this._requests.connect=[]),new this._promise((function(t,n){var r=setTimeout((function(){n(new Error("CrossStorageClient could not connect"))}),e._timeout);e._requests.connect.push((function(e){if(clearTimeout(r),e)return n(e);t()}))})))},r.prototype.set=function(e,t){return this._request("set",{key:e,value:t})},r.prototype.get=function(e){var t=Array.prototype.slice.call(arguments);return this._request("get",{keys:t})},r.prototype.del=function(){var e=Array.prototype.slice.call(arguments);return this._request("del",{keys:e})},r.prototype.clear=function(){return this._request("clear")},r.prototype.getKeys=function(){return this._request("getKeys")},r.prototype.close=function(){var e=document.getElementById(this._frameId);e&&e.parentNode.removeChild(e),window.removeEventListener?window.removeEventListener("message",this._listener,!1):window.detachEvent("onmessage",this._listener),this._connected=!1,this._closed=!0},r.prototype._installListener=function(){var e=this;this._listener=function(t){var n,r,i;if(!e._closed&&t.data&&"string"==typeof t.data&&("null"===t.origin?"file://":t.origin)===e._origin)if("cross-storage:unavailable"!==t.data){if(-1!==t.data.indexOf("cross-storage:")&&!e._connected){if(e._connected=!0,!e._requests.connect)return;for(n=0;n<e._requests.connect.length;n++)e._requests.connect[n](r);delete e._requests.connect}if("cross-storage:ready"!==t.data){try{i=JSON.parse(t.data)}catch(e){return}i.id&&e._requests[i.id]&&e._requests[i.id](i.error,i.result)}}else{if(e._closed||e.close(),!e._requests.connect)return;for(r=new Error("Closing client. Could not access localStorage in hub."),n=0;n<e._requests.connect.length;n++)e._requests.connect[n](r)}},window.addEventListener?window.addEventListener("message",this._listener,!1):window.attachEvent("onmessage",this._listener)},r.prototype._poll=function(){var e,t,n;n="file://"===(e=this)._origin?"*":e._origin,t=setInterval((function(){if(e._connected)return clearInterval(t);e._hub&&e._hub.postMessage("cross-storage:poll",n)}),1e3)},r.prototype._createFrame=function(e){var t,n;for(n in(t=window.document.createElement("iframe")).id=this._frameId,r.frameStyle)r.frameStyle.hasOwnProperty(n)&&(t.style[n]=r.frameStyle[n]);return window.document.body.appendChild(t),t.src=e,t},r.prototype._request=function(e,t){var n,r;return this._closed?this._promise.reject(new Error("CrossStorageClient has closed")):((r=this)._count++,n={id:this._id+":"+r._count,method:"cross-storage:"+e,params:t},new this._promise((function(e,t){var i,s,o;i=setTimeout((function(){r._requests[n.id]&&(delete r._requests[n.id],t(new Error("Timeout: could not perform "+n.method)))}),r._timeout),r._requests[n.id]=function(s,o){if(clearTimeout(i),delete r._requests[n.id],s)return t(new Error(s));e(o)},Array.prototype.toJSON&&(s=Array.prototype.toJSON,Array.prototype.toJSON=null),o="file://"===r._origin?"*":r._origin,r._hub.postMessage(JSON.stringify(n),o),s&&(Array.prototype.toJSON=s)})))},e.exports?e.exports=r:t.CrossStorageClient=r}()},function(e,t,n){var r;r={init:function(e){var t=!0;try{window.localStorage||(t=!1)}catch(e){t=!1}if(!t)try{return window.parent.postMessage("cross-storage:unavailable","*")}catch(e){return}r._permissions=e||[],r._installListener(),window.parent.postMessage("cross-storage:ready","*")},_installListener:function(){var e=r._listener;window.addEventListener?window.addEventListener("message",e,!1):window.attachEvent("onmessage",e)},_listener:function(e){var t,n,i,s,o,u,a;if(t="null"===e.origin?"file://":e.origin,"cross-storage:poll"===e.data)return window.parent.postMessage("cross-storage:ready",e.origin);if("cross-storage:ready"!==e.data){try{i=JSON.parse(e.data)}catch(e){return}if(i&&"string"==typeof i.method&&(s=i.method.split("cross-storage:")[1])){if(r._permitted(t,s))try{u=r["_"+s](i.params)}catch(e){o=e.message}else o="Invalid permissions for "+s;a=JSON.stringify({id:i.id,error:o,result:u}),n="file://"===t?"*":t,window.parent.postMessage(a,n)}}},_permitted:function(e,t){var n,i,s;if(n=["get","set","del","clear","getKeys"],!r._inArray(t,n))return!1;for(i=0;i<r._permissions.length;i++)if((s=r._permissions[i]).origin instanceof RegExp&&s.allow instanceof Array&&s.origin.test(e)&&r._inArray(t,s.allow))return!0;return!1},_set:function(e){window.localStorage.setItem(e.key,e.value)},_get:function(e){var t,n,r,i;for(t=window.localStorage,n=[],r=0;r<e.keys.length;r++){try{i=t.getItem(e.keys[r])}catch(e){i=null}n.push(i)}return n.length>1?n:n[0]},_del:function(e){for(var t=0;t<e.keys.length;t++)window.localStorage.removeItem(e.keys[t])},_clear:function(){window.localStorage.clear()},_getKeys:function(e){var t,n,r;for(r=[],n=window.localStorage.length,t=0;t<n;t++)r.push(window.localStorage.key(t));return r},_inArray:function(e,t){for(var n=0;n<t.length;n++)if(e===t[n])return!0;return!1},_now:function(){return"function"==typeof Date.now?Date.now():(new Date).getTime()}},e.exports?e.exports=r:t.CrossStorageHub=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.config=e}return e._getUri=function(){return window.location.toString()},e.prototype.track=function(t,n){void 0===n&&(n=!1),t.url=e._getUri(),this.config.tags=this.config.tags||[];var r=this._cleanCombineTwoArrays(t.tags,this.config.tags);if(t=Object.assign(t,this.config),r.length>0&&(t.tags=r),!n)return this._sendRequest(e._getRequestOptions(t),n);this._sendRequest(e._getRequestOptions(t),n)},e.prototype.addConstantTag=function(e){if("string"==typeof e){var t=!1;this.config.tags=this.config.tags||[],this.config.tags.map((function(n){n.toLowerCase()===e.toLowerCase()&&(t=!0)})),t||this.config.tags.push(e)}},e.prototype._cleanCombineTwoArrays=function(e,t){void 0===e&&(e=[]),void 0===t&&(t=[]);var n=e.concat(t);return n.filter((function(e,t){return n.indexOf(e)===t}))},e.prototype._sendRequest=function(e,t){return void 0===t&&(t=!1),new Promise((function(n,r){var i=new XMLHttpRequest;t&&(i.onreadystatechange=function(){i.readyState===XMLHttpRequest.DONE&&(200===i.status?n(JSON.parse(i.responseText)):r(JSON.parse(i.responseText)))}),i.open(e.method,e.url),i.setRequestHeader("Content-Type","application/json"),i.send(e.body)}))},e._getRequestOptions=function(e){return{url:"https://c6coiy9r7a.execute-api.eu-west-1.amazonaws.com/prd/events",method:"PUT",body:JSON.stringify(e)}},e}();t.default=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(12),o=function(){function e(){}return e.prototype.get=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,s.DataStorage.retrieve(e)]}))}))},e.prototype.set=function(e,t,n){return r(this,void 0,void 0,(function(){return i(this,(function(r){return[2,s.DataStorage.store(e,t,n)]}))}))},e.prototype.remove=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){return[2,s.DataStorage.remove(e)]}))}))},e}();t.DataStorageDriver=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={General:"General",JWTAuth:"JWTAuth",StudentsAPIRequest:"StudentsAPIRequest",SLRequest:"SLRequest"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={JSError:"JSError",JWTAuthError:"JWTAuthError",StudentsAPIError:"StudentsAPIError",SLError:"SLError"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={Error:"Error"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Study=class{constructor(e){this.id=e}get Venue(){return this.venue}set Venue(e){this.venue=e}get University(){return this.university}set University(e){this.university=e}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(47)),r(n(48)),r(n(26)),r(n(49)),r(n(50)),r(n(2))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);class i extends r.WishlistException{constructor(){super("ExpectedState doesn't match current state of wishlist"),this.name="IncorrectWishlistState"}}t.IncorrectWishlistState=i},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(51)),r(n(54))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(55)),r(n(65)),r(n(66))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(61))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);class i extends r.WishlistException{constructor(e){super("Invalid study id, expected to be of type number: "+JSON.stringify(e)),this.studyId=e,this.name="FavouriteInvalidStudyId"}}t.FavouriteInvalidStudyId=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetWishlistQueryResult=class{constructor(e){this.wishlist=e}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.enabled=!1}return e.prototype.init=function(){try{if("undefined"==typeof localStorage)return void(this.enabled=!1);localStorage.setItem("test","dummy value"),localStorage.removeItem("test"),this.enabled=!0}catch(e){this.enabled=!1}},e.prototype.store=function(e,t,n){if(void 0===n&&(n=1800),this.enabled){var r=new Date,i={expires:r.setSeconds(r.getSeconds()+n),data:t};localStorage[e]=JSON.stringify(i)}else document.cookie=e+"="+t+";expires="+n/86400;return!0},e.prototype.retrieve=function(e){if(this.enabled){var t=localStorage[e];try{t=JSON.parse(t)}catch(e){t={}}if(!t||!t.hasOwnProperty("expires")||!t.hasOwnProperty("data"))return"";var n=parseInt(t.expires,10);return isNaN(n)&&(n=0),new Date>=new Date(n)?(localStorage[e]=null,""):t.data}return this.getCookie(e)},e.prototype.remove=function(e){this.enabled?delete localStorage[e]:document.cookie=e+"=;expires=Thu, 01 Jan 1970 00:00:01 GMT;"},e.prototype.update=function(e,t,n){var r=this.retrieve(e);return"object"!=typeof r&&(r={}),r=Object.assign({},r,t),this.store(e,r,n),r},e.prototype.getCookie=function(e){var t=RegExp(e+"=.[^;]*"),n=document.cookie.match(t);return n?n[0].split("=")[1]:""},e}();t.DataStorage=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrackedLink=void 0;var r=function(){function e(e,t,n){void 0===n&&(n=null),this.tracking=e,this.url=t,this.description=n}return e.prototype.getTracking=function(){return this.tracking},e.prototype.getUrl=function(){return this.url},e.prototype.getDescription=function(){if(!this.canShowDescription())throw new Error("No description available for this item");return this.description},e.prototype.canShowDescription=function(){return!this.description},e}();t.TrackedLink=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Tracking=void 0;var r=function(){function e(e,t,n,r,i,s,o){this.googleAnalyticsTracking=e,this.action=t,this.type=n,this.id=r,this.description=i,this.label=s,this.extra=o}return e.prototype.getAction=function(){return this.action},e.prototype.getDescription=function(){return this.description},e.prototype.getExtra=function(){return this.extra},e.prototype.getGoogleAnalyticsTracking=function(){return this.googleAnalyticsTracking},e.prototype.getId=function(){return this.id},e.prototype.getLabel=function(){return this.label},e.prototype.getType=function(){return this.type},e}();t.Tracking=r},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.PremiumVariantType=void 0,(r=t.PremiumVariantType||(t.PremiumVariantType={})).VARIANT_DEFAULT="default",r.VARIANT_OUT_OF_RANGE="ooRange",r.VARIANT_OUT_OF_DATE="ooDate"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(117))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidAccessTokenError=function(e){this.message=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(39),s={environment:r.default.stage?r.default.stage:"dev",team:"xm",product:"WishlistService",category:"Wishlist"},o=new i.Bootstrapper(window.EventAggregationService,window.SessionService,r.default.wishlistServiceBaseUrl,s);o.configureEnvironment(),o.setupApplication()},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=n(19),u=n(20),a=n(3),c=n(78),l=n(88),h=n(89),f=n(93),d=n(94),p=n(96),y=n(98),v=n(100),g=n(101),b=n(102),w=function(){function e(e,t,n,r){this.eventService=e,this.sessionService=t,this.wishlistBaseUrl=n,this.spTrackerConfig=r,this.localWishlistService=null,this.remoteWishlistService=null,this.localWishlistRepository=null,this.queueWishlistService=new h.QueueWishlistService,this.wishlistCache=null}return e.prototype.configureEnvironment=function(){var e=new u.DataStorageDriver;this.wishlistCache=new b.WishlistCache(e),this.remoteWishlistService=this.createRemoteWishlistService(),this.localWishlistService=this.createLocalWishlistService(e)},e.prototype.setupApplication=function(){var e=this;this.setupOnSessionServiceReady(),this.eventService.subscribeToSessionCreatedEvent(new a.CallbackSubscriber((function(){return e.onSessionCreated()}))),this.eventService.subscribeToSessionDestroyedEvent(new a.CallbackSubscriber((function(){return e.onSessionDestroyed()}))),new d.WebSocketFavouriteAddedAdapter(this.eventService,this.wishlistCache).initialize(),new p.WebSocketFavouriteRemovedAdapter(this.eventService,this.wishlistCache).initialize(),new y.WebsocketWishlistOrderChangedAdapter(this.eventService,this.wishlistCache).initialize()},e.prototype.setWishlistService=function(e){this.queueWishlistService.setWishlistService(e)},e.prototype.synchroniseLocalWishlistToRemote=function(){return r(this,void 0,void 0,(function(){var e,t,n,r,s,o,u;return i(this,(function(i){switch(i.label){case 0:return[4,this.localWishlistService.getWishlist()];case 1:return null===(e=i.sent())?[3,8]:[4,this.remoteWishlistService.getWishlist()];case 2:for(n in i.sent(),t=[],e.favourites)t.push(n);r=0,i.label=3;case 3:return r<t.length?(s=t[r],o=e.favourites[s],u=o.study.id,[4,this.remoteWishlistService.addFavourite(u)]):[3,6];case 4:i.sent(),i.label=5;case 5:return r++,[3,3];case 6:return[4,this.localWishlistRepository.removeWishlist()];case 7:i.sent(),i.label=8;case 8:return[2]}}))}))},e.prototype.onSessionDestroyed=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.setWishlistService(this.localWishlistService),[4,this.wishlistCache.clearCache()];case 1:return e.sent(),[2]}}))}))},e.prototype.onSessionCreated=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.setWishlistService(this.remoteWishlistService),[4,this.synchroniseLocalWishlistToRemote()];case 1:return e.sent(),[2]}}))}))},e.prototype.setQueueWishlistServiceOnWindow=function(){window.wishlistService=this.queueWishlistService},e.prototype.setupOnSessionServiceReady=function(){var e=this;this.sessionService.isReady&&this.onSessionServiceReady(),this.eventService.subscribeToSessionServiceReadyEvent(new a.CallbackSubscriber((function(){return e.onSessionServiceReady()})))},e.prototype.onSessionServiceReady=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.sessionService.getSession()];case 1:return null===e.sent()?this.setWishlistService(this.localWishlistService):(this.setWishlistService(this.remoteWishlistService),this.synchroniseLocalWishlistToRemote()),this.setQueueWishlistServiceOnWindow(),this.eventService.publishWishlistServiceReadyEvent(this.queueWishlistService),[2]}}))}))},e.prototype.createLocalWishlistService=function(e){var t=new v.EventAggregationServiceEventEmitter(this.eventService),n=new g.LocalWishlistRepository(e);this.localWishlistRepository=n;var r=new s.DefaultAddToWishlistCommandHandler(n,t),i=new s.DefaultRemoveFromWishlistCommandHandler(n,t),o=new s.SetWishlistOrderCommandHandler(n,t),u=new s.DefaultGetWishlistQueryHandler(n);return new f.RetryCommandWishlistService(new l.LocalWishlistService(r,u,i,o))},e.prototype.createRemoteWishlistService=function(){var e=new o.default(this.spTrackerConfig);return new f.RetryCommandWishlistService(new c.DecisionMakingApiWishlistService(this.sessionService,this.wishlistBaseUrl,this.wishlistCache,e))},e}();t.Bootstrapper=w},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(41)),r(n(67)),r(n(70)),r(n(73)),r(n(76))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(42)),r(n(43))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AddToWishlistCommand=class{constructor(e,t,n){this.userId=e,this.studyId=t,this.expectedState=n}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),s=n(30),o=n(11);class u extends o.BaseWishlistCommandHandler{constructor(e,t){super(e),this.wishlistRepository=e,this.eventEmitter=t}validate(e){if("number"!=typeof e.studyId)throw new s.FavouriteInvalidStudyId(e.studyId)}handle({studyId:e,userId:t,expectedState:n}){return r(this,void 0,void 0,(function*(){try{this.validate({studyId:e,userId:t,expectedState:n});const r=yield this.getWishlist(t,n),s=i.Favourite.create(e);return r.addFavourite(s),yield this.wishlistRepository.addFavourite(r,s),yield this.emitFavouriteAddedEvent(t,e,s.dateAdded),{resultingState:r.stateHash}}catch(e){if(e instanceof i.StudyAlreadyFavourited)return{resultingState:n};throw e}}))}emitFavouriteAddedEvent(e,t,n){return r(this,void 0,void 0,(function*(){yield this.eventEmitter.emit(i.FavouriteAdded.eventName,i.FavouriteAdded.create(e,t,n))}))}}t.DefaultAddToWishlistCommandHandler=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(45)),r(n(24)),r(n(46))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(24);class i{constructor(e,t){this.study=e,this.dateAdded=t}static create(e){return new i(new r.Study(e),new Date)}}t.Favourite=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(25),i=n(27);t.Wishlist=class{constructor(e){this.userId=e,this._favourites=[]}get favourites(){return this._favourites}get stateHash(){const e=this._favourites.map(e=>e.study.id);return i.StateHasher.hash(e)}changeOrder(e,t){if(e===t)throw new r.WishlistException("targetStudy cannot be the same study as referenceStudy");if(!this.isFavourited(e))throw new r.WishlistException("targetStudy does not exist");let n=-1;const i=this.removeAndRetrieveFavouriteFromFavourites(e);if(t){if(!this.isFavourited(t))throw new r.WishlistException("referenceStudy does not exist");n=this.favourites.findIndex(e=>e.study.id===t)}this.favourites.splice(n+1,0,i)}removeAndRetrieveFavouriteFromFavourites(e){const t=this.favourites.findIndex(t=>t.study.id===e),n=this.favourites[t];return this.favourites.splice(t,1),n}addFavourite(e){if(this.containsStudy(e.study.id))throw new r.StudyAlreadyFavourited(this.userId,e.study.id);this._favourites.push(e)}removeFavourite(e){this.removeStudyFromFavourites(e)}containsStudy(e){return this._favourites.some(t=>t.study.id===e)}findFavourite(e){return this._favourites.find(t=>t.study.id===e)||null}removeStudyFromFavourites(e){let t=!1;if(this._favourites=this._favourites.filter(n=>{const r=n.study.id===e;return r&&(t=!0),!r}),!t)throw new r.FavouriteNotFound(this.userId,e)}toJSON(){return{userId:this.userId,favourites:this._favourites}}isFavourited(e){return this._favourites.some(t=>t.study.id===e)}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);class i extends r.WishlistException{constructor(){super("Favourite found without a study"),this.name="FavouriteFoundWithoutStudy"}}t.FavouriteFoundWithoutStudy=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);class i extends r.WishlistException{constructor(e,t){super(`Favourite with study id ${t} from wishlist ${e} not found.`),this.name="FavouriteNotFound"}}t.FavouriteNotFound=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);class i extends r.WishlistException{constructor(e,t){super(`Favourite with study id ${t} from wishlist ${e} already exists.`),this.wishlistId=e,this.studyId=t,this.name="StudyAlreadyFavourited"}}t.StudyAlreadyFavourited=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(2);class i extends r.WishlistException{constructor(e){super(`Wishlist with id ${e} not found`),this.wishlistId=e,this.name="WishlistNotFound"}}t.WishlistNotFound=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(52);t.StateHasher=class{static hash(e){return r(JSON.stringify(e)).toString()}}},function(e,t,n){var r,i,s,o,u,a,c,l;e.exports=(i=(r=l=n(53)).lib,s=i.WordArray,o=i.Hasher,u=r.algo,a=[],c=u.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],u=n[4],c=0;c<80;c++){if(c<16)a[c]=0|e[t+c];else{var l=a[c-3]^a[c-8]^a[c-14]^a[c-16];a[c]=l<<1|l>>>31}var h=(r<<5|r>>>27)+u+a[c];h+=c<20?1518500249+(i&s|~i&o):c<40?1859775393+(i^s^o):c<60?(i&s|i&o|s&o)-1894007588:(i^s^o)-899497514,u=o,o=s,s=i<<30|i>>>2,i=r,r=h}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+u|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=o._createHelper(c),r.HmacSHA1=o._createHmacHelper(c),l.SHA1)},function(e,t,n){var r;e.exports=r=r||function(e,t){var n=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),r={},i=r.lib={},s=i.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},o=i.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||a).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else for(s=0;s<i;s+=4)t[r+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=s.clone.call(this);return e.words=this.words.slice(0),e},random:function(t){for(var n,r=[],i=function(t){t=t;var n=987654321,r=4294967295;return function(){var i=((n=36969*(65535&n)+(n>>16)&r)<<16)+(t=18e3*(65535&t)+(t>>16)&r)&r;return i/=4294967296,(i+=.5)*(e.random()>.5?1:-1)}},s=0;s<t;s+=4){var u=i(4294967296*(n||e.random()));n=987654071*u(),r.push(4294967296*u()|0)}return new o.init(r,t)}}),u=r.enc={},a=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new o.init(n,t/2)}},c=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new o.init(n,t)}},l=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(c.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return c.parse(unescape(encodeURIComponent(e)))}},h=i.BufferedBlockAlgorithm=s.extend({reset:function(){this._data=new o.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=l.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n=this._data,r=n.words,i=n.sigBytes,s=this.blockSize,u=i/(4*s),a=(u=t?e.ceil(u):e.max((0|u)-this._minBufferSize,0))*s,c=e.min(4*a,i);if(a){for(var l=0;l<a;l+=s)this._doProcessBlock(r,l);var h=r.splice(0,a);n.sigBytes-=c}return new o.init(h,c)},clone:function(){var e=s.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(i.Hasher=h.extend({cfg:s.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new f.HMAC.init(e,n).finalize(t)}}}),r.algo={});return r}(Math)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(26);t.WishlistStateValidator=class{validate(e,t){if(e.stateHash!==t)throw new r.IncorrectWishlistState}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(10);class i extends r.DomainEvent{constructor(e,t,n,r){super(n),this.userId=e,this.studyId=t,this.eventId=n,this.dateAdded=r,this.eventType=i.eventName,this.eventVersion="1.0.0"}static create(e,t,n=new Date){return new i(e,t,r.DomainEvent.generateId(),n)}}i.eventName="FavouriteAdded",t.FavouriteAdded=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(57))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(58);t.DomainEvent=class{constructor(e){this.eventId=e}static generateId(){return r()}}},function(e,t,n){var r=n(59),i=n(60);e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var u=0;u<16;++u)t[s+u]=o[u];return t||i(o)}},function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0,i=n;return[i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],"-",i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]],i[e[r++]]].join("")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JSONValidationFactory=class{fromJSON(e){return this.map(JSON.parse(e))}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(63))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(64))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(29);class i extends r.JSONValidationFactory{inject(e){return this.fromJSON(e)}}t.JSONInPort=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(10);class i extends r.DomainEvent{constructor(e,t,n,r){super(n),this.userId=e,this.studyId=t,this.eventId=n,this.dateRemoved=r,this.eventType=i.eventName,this.eventVersion="1.0.0"}static create(e,t,n){return new i(e,t,r.DomainEvent.generateId(),n)}}i.eventName="FavouriteRemoved",t.FavouriteRemoved=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(10);class i extends r.DomainEvent{constructor(e,t,n,r,s){super(r),this.userId=e,this.targetStudyId=t,this.referenceStudyId=n,this.eventId=r,this.dateChanged=s,this.eventType=i.eventName,this.eventVersion="1.0.0"}static create(e,t,n,s=new Date){return new i(e,t,n,r.DomainEvent.generateId(),s)}}i.eventName="WishlistOrderChanged",t.WishlistOrderChanged=i},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(68)),r(n(69))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoveFromWishlistCommand=class{constructor(e,t,n){this.userId=e,this.studyId=t,this.expectedState=n}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),s=n(30),o=n(11);class u extends o.BaseWishlistCommandHandler{constructor(e,t){super(e),this.wishlistRepository=e,this.eventEmitter=t}validate(e){if("number"!=typeof e.studyId)throw new s.FavouriteInvalidStudyId(e.studyId)}handle({studyId:e,userId:t,expectedState:n}){return r(this,void 0,void 0,(function*(){try{this.validate({studyId:e,userId:t,expectedState:n});const r=yield this.getWishlist(t,n);r.removeFavourite(e);const s=this.getCurrentDate();return yield this.wishlistRepository.removeFavourite(r,i.Favourite.create(e),s),yield this.emitFavouriteRemovedEvent(t,e,s),{resultingState:r.stateHash}}catch(e){if(e instanceof i.FavouriteNotFound)return{resultingState:n};throw e}}))}getCurrentDate(){return new Date}emitFavouriteRemovedEvent(e,t,n){return r(this,void 0,void 0,(function*(){yield this.eventEmitter.emit(i.FavouriteRemoved.eventName,i.FavouriteRemoved.create(e,t,n))}))}}t.DefaultRemoveFromWishlistCommandHandler=u},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(71)),r(n(72)),r(n(31))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GetWishlistQuery=class{constructor(e){this.userId=e}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(31);t.DefaultGetWishlistQueryHandler=class{constructor(e){this.wishlistRepository=e}handle({userId:e}){return r(this,void 0,void 0,(function*(){let t=yield this.wishlistRepository.retrieveByUserId(e);return null===t&&(t=yield this.wishlistRepository.createWishlist(e)),new i.GetWishlistQueryResult(t)}))}}},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(74)),r(n(75))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SetWishlistOrderCommand=class{constructor(e,t,n,r){this.userId=e,this.targetStudyId=t,this.position=n,this.expectedState=r}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0});const i=n(4),s=n(28),o=n(11);class u extends o.BaseWishlistCommandHandler{constructor(e,t){super(e),this.wishlistRepository=e,this.eventEmitter=t}handle({userId:e,targetStudyId:t,position:n,expectedState:s}){return r(this,void 0,void 0,(function*(){const r=yield this.getWishlist(e,s);let o=null;if(0!==n){if(!r.favourites[n])throw new i.WishlistException("Position out of bounds");o=r.favourites[n].study.id}return r.changeOrder(t,o),yield this.wishlistRepository.setWishlistOrder(r,t,o),yield this.emitWishListOrderChangedEvent(e,t,o,new Date),{resultingState:r.stateHash}}))}emitWishListOrderChangedEvent(e,t,n,i){return r(this,void 0,void 0,(function*(){yield this.eventEmitter.emit(s.WishlistOrderChanged.eventName,s.WishlistOrderChanged.create(e,t,n,i))}))}}t.SetWishlistOrderCommandHandler=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}(n(77))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommandResult=class{constructor(e){this.resultingState=e}}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=n(5),u=n(21),a=n(22),c=n(23),l=n(13),h=function(){function e(e,t,n,r){this.sessionService=e,this.baseUrl=t,this.wishlistCache=n,this.tracker=r}return Object.defineProperty(e.prototype,"fetch",{get:function(){return o.default},enumerable:!0,configurable:!0}),e.prototype.addFavourite=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.getWishlist()];case 1:return t=n.sent(),[4,this.executeRequest("","POST",{studyId:e,expectedState:t.stateHash})];case 2:return n.sent(),[2]}}))}))},e.prototype.getWishlist=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.wishlistCache.getWishlist()];case 1:return null!==(e=t.sent())?[3,4]:[4,this.retrieveWishlistFromApi()];case 2:return e=t.sent(),[4,this.wishlistCache.setWishlist(e)];case 3:t.sent(),t.label=4;case 4:return[2,e]}}))}))},e.prototype.removeFavourite=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.getWishlist()];case 1:return t=n.sent(),[4,this.executeRequest("","DELETE",{studyId:e,expectedState:t.stateHash})];case 2:return n.sent(),[2]}}))}))},e.prototype.setOrder=function(e,t){return r(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.getWishlist()];case 1:return n=r.sent(),[4,this.executeRequest("/order","PATCH",{targetStudyId:e,position:t,expectedState:n.stateHash})];case 2:return r.sent(),[2]}}))}))},e.prototype.retrieveWishlistFromApi=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.executeRequest("")];case 1:return e=t.sent().wishlist,[2,l.WishlistFactory.translateSerializedWishlist(e)]}}))}))},e.prototype.getRequestOptions=function(e,t){return r(this,void 0,void 0,(function(){var n,r,s;return i(this,(function(i){switch(i.label){case 0:return r={},s={},[4,this.getAuthorizationToken()];case 1:return r.headers=(s.Authorization=i.sent(),s),r.method=e,n=r,null!==t&&(n.body=JSON.stringify(t)),[2,n]}}))}))},e.prototype.executeRequest=function(e,t,n){return void 0===t&&(t="GET"),void 0===n&&(n=null),r(this,void 0,void 0,(function(){var r,o,u,a;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,6,,7]),[4,this.getRequestOptions(t,n)];case 1:return r=i.sent(),[4,this.fetch(this.getFullUrl(e),r)];case 2:return[4,(o=i.sent()).json()];case 3:return u=i.sent(),o.ok&&!u.failed?[3,5]:[4,this.handleError(u)];case 4:throw i.sent();case 5:return[2,u];case 6:throw(a=i.sent())instanceof s.WishlistException||(a=new Error("An unknown issue encountered while contacting our wishlist service")),a;case 7:return[2]}}))}))},e.prototype.getFullUrl=function(e){return""+this.baseUrl+e},e.prototype.getAuthorizationToken=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.sessionService.getSession()];case 1:return[2,e.sent().getAccessToken()]}}))}))},e.prototype.handleIncorrectWishlistStateException=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.wishlistCache.clearCache()];case 1:return e.sent(),[2,new s.IncorrectWishlistState]}}))}))},e.prototype.handleWishlistNotFoundException=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.wishlistCache.clearCache()];case 1:return t.sent(),[2,new s.WishlistNotFound(e.wishlistId)]}}))}))},e.prototype.handleDefaultException=function(e){return r(this,void 0,void 0,(function(){var t,n,r,o,l,h,f,d;return i(this,(function(i){switch(i.label){case 0:return void 0===e.message||"Unauthorized"!==e.message?[3,3]:[4,window.SessionService.getSession()];case 1:return t=i.sent(),n=t.getUser(),o=(r=this.tracker).track,l={action:u.default.General,label:a.default.JWTAuthError,tags:[c.default.Error]},f=(h=JSON).stringify,d={identityId:n.identityId},[4,t.getAccessToken()];case 2:o.apply(r,[(l.eventData=f.apply(h,[(d.token=i.sent(),d.time=Date.now(),d.localTime=(new Date).toLocaleString(),d.needsToRefresh=t.shouldRefresh(),d)]),l)]),i.label=3;case 3:return[2,new s.WishlistException("An unknown issue encountered while contacting our wishlist service")]}}))}))},e.prototype.handleError=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(e.name){case"IncorrectWishlistState":return[2,this.handleIncorrectWishlistStateException()];case"WishlistNotFound":return[2,this.handleWishlistNotFoundException(e)];default:return[2,this.handleDefaultException(e)]}return[2]}))}))},e}();t.DecisionMakingApiWishlistService=h},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(80),t),i(n(33),t),i(n(34),t),i(n(81),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PremiumLinkService=void 0;var r=n(82),i=n(83),s=n(86),o=n(35),u=n(87),a=function(){function e(e){this.programmeData=new r.ProgrammeData(e),this.programmePremium=new i.ProgrammePremium(this.programmeData,new s.StaticPremiumVariants(o.PremiumVariantType.VARIANT_DEFAULT)),this.trackedLinkFactory=new u.TrackedLinkFactory(this.programmeData,this.programmePremium)}return e.prototype.getPremiumLink=function(e){return this.programmePremium.mayShowWebsiteLink()?this.trackedLinkFactory.buildTrackedLink(this.programmeData.getHomepageLink(),e):null},e}();t.PremiumLinkService=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgrammeData=void 0;var r=function(){function e(e){this.data=e}return e.prototype.getId=function(){return Number(this.data.id)},e.prototype.getFirstElementOrNull=function(e){var t=this.data[e];for(var n in t)return t[n];return null},e.prototype.getPremiumsOutOfRange=function(){return this.data.premiums_out_of_range},e.prototype.getPremiumsOutOfDate=function(){return this.data.premiums_out_of_date},e.prototype.getPremiums=function(){return this.data.premiums},e.prototype.getCpm=function(){return Number(this.data.cpm)},e.prototype.getCommercialRange=function(){return this.data.commercial_range},e.prototype.getHomepageLink=function(){return this.getFirstElementOrNull("link_homepage")},e}();t.ProgrammeData=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgrammePremium=void 0;var r=n(35),i=n(84),s=n(85),o=function(){function e(e,t){this.programmeData=e,this.premiumVariants=t,this.type=this.resolvePremiumType(e);var n=t.getVariant();n!==r.PremiumVariantType.VARIANT_OUT_OF_RANGE?n!==r.PremiumVariantType.VARIANT_OUT_OF_DATE?this.premiums=e.getPremiums():this.premiums=e.getPremiumsOutOfDate():this.premiums=e.getPremiumsOutOfRange()}return e.prototype.resolvePremiumType=function(e){var t=e.getCpm();if(0===t)return s.ProgrammePremiumType.BASIC;if(5e3===t)return s.ProgrammePremiumType.SUPER_PREMIUM;if(2500===t)return s.ProgrammePremiumType.PREMIUM;if(1e3===t)return s.ProgrammePremiumType.LIGHT;var n=e.getCommercialRange();return 50==n[1]-n[0]+1?s.ProgrammePremiumType.SUPER_LIGHT:s.ProgrammePremiumType.SUPER_SUPER_LIGHT},e.prototype.mayShowWebsiteLink=function(){return this.premiums.includes(i.ProgrammePremiumFeatureType.PREMIUM_LINKS)},e.prototype.getPremiumType=function(){return this.type},e}();t.ProgrammePremium=o},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ProgrammePremiumFeatureType=void 0,(r=t.ProgrammePremiumFeatureType||(t.ProgrammePremiumFeatureType={})).PREMIUM_DISPLAY_PREMIUM="display_premium",r.PREMIUM_DISPLAY_REGULAR="display_regular",r.PREMIUM_LOGO="logo",r.PREMIUM_LINKS="links_website",r.PREMIUM_GALLERY="gallery",r.PREMIUM_HIDE_BANNERS="hide_banners"},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),t.ProgrammePremiumType=void 0,(r=t.ProgrammePremiumType||(t.ProgrammePremiumType={})).SUPER_PREMIUM="sp",r.PREMIUM="p",r.LIGHT="l",r.SUPER_LIGHT="sl",r.SUPER_SUPER_LIGHT="ssl",r.BASIC="b"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StaticPremiumVariants=void 0;var r=function(){function e(e){this.variation=e}return e.prototype.getVariant=function(){return this.variation},e}();t.StaticPremiumVariants=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TrackedLinkFactory=void 0;var r=n(33),i=n(34),s=function(){function e(e,t){this.programmeData=e,this.programmePremium=t}return e.prototype.buildTrackedLink=function(e,t){return e?new r.TrackedLink(this.getTrackingForLink(e,t),this.getExternalUrl(e.url),e.description):null},e.prototype.getTrackingForLink=function(e,t){var n={category:"Study",action:this.getGaAction(),label:this.programmeData.getId().toString(),value:t},r={pt:this.programmePremium.getPremiumType()};return new i.Tracking(JSON.stringify(n),"clic","link",e.id,e.url,this.getLabel(),JSON.stringify(r))},e.prototype.getExternalUrl=function(e){return"track/click/?target="+encodeURIComponent(e)},e.prototype.getGaAction=function(){return"Premium Click"},e.prototype.getLabel=function(){return"revenue"},e}();t.TrackedLinkFactory=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=function(){function e(e,t,n,r){this.addToWishlistCommandHandler=e,this.getWishlistQueryHandler=t,this.removeFromWishlistCommandHandler=n,this.setWishlistOrderCommandHandler=r,this.userId="local-wishlist"}return e.prototype.addFavourite=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.getWishlist()];case 1:return t=r.sent(),n=this.createAddToWishlistCommand(e,t),[4,this.addToWishlistCommandHandler.handle(n)];case 2:return r.sent(),[2]}}))}))},e.prototype.getWishlist=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return e=this.createGetWishlistQuery(),[4,this.getWishlistQueryHandler.handle(e)];case 1:return[2,t.sent().wishlist]}}))}))},e.prototype.removeFavourite=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.getWishlist()];case 1:return t=r.sent(),n=this.createRemoveFromWishlistCommand(e,t),[4,this.removeFromWishlistCommandHandler.handle(n)];case 2:return r.sent(),[2]}}))}))},e.prototype.setOrder=function(e,t){return r(this,void 0,void 0,(function(){var n,r;return i(this,(function(i){switch(i.label){case 0:return[4,this.getWishlist()];case 1:return n=i.sent(),r=this.createSetWishlistOrderCommand(e,t,n),[4,this.setWishlistOrderCommandHandler.handle(r)];case 2:return i.sent(),[2]}}))}))},e.prototype.createGetWishlistQuery=function(){return new s.GetWishlistQuery(this.userId)},e.prototype.createAddToWishlistCommand=function(e,t){return new s.AddToWishlistCommand(this.userId,e,t.stateHash)},e.prototype.createRemoveFromWishlistCommand=function(e,t){return new s.RemoveFromWishlistCommand(this.userId,e,t.stateHash)},e.prototype.createSetWishlistOrderCommand=function(e,t,n){return new s.SetWishlistOrderCommand(this.userId,e,t,n.stateHash)},e}();t.LocalWishlistService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(90),i=function(){function e(){this.queue=new r(1,1/0)}return e.prototype.setWishlistService=function(e){this.wishlistService=e},e.prototype.getWishlist=function(){var e=this;return this.queue.add((function(){return e.wishlistService.getWishlist()}))},e.prototype.addFavourite=function(e){var t=this;return this.queue.add((function(){return t.wishlistService.addFavourite(e)}))},e.prototype.removeFavourite=function(e){var t=this;return this.queue.add((function(){return t.wishlistService.removeFavourite(e)}))},e.prototype.setOrder=function(e,t){var n=this;return this.queue.add((function(){return n.wishlistService.setOrder(e,t)}))},e}();t.QueueWishlistService=i},function(e,t,n){e.exports=Object({NODE_ENV:"production"}).PROMISE_QUEUE_COVERAGE?n(91):n(92)},function(e,t){},function(e,t,n){var r,i;!function(s,o){"use strict";e.exports?e.exports=o():void 0===(i="function"==typeof(r=o)?r.call(t,n,t,e):r)||(e.exports=i)}(0,(function(){"use strict";var e="undefined"!=typeof Promise?Promise:function(){return{then:function(){throw new Error("Queue.configure() before use Queue")}}},t=function(){};function n(e,t,n){this.options=n=n||{},this.pendingPromises=0,this.maxPendingPromises=void 0!==e?e:1/0,this.maxQueuedPromises=void 0!==t?t:1/0,this.queue=[]}return n.configure=function(t){e=t},n.prototype.add=function(n){var r=this;return new e((function(e,i,s){r.queue.length>=r.maxQueuedPromises?i(new Error("Queue limit reached")):(r.queue.push({promiseGenerator:n,resolve:e,reject:i,notify:s||t}),r._dequeue())}))},n.prototype.getPendingLength=function(){return this.pendingPromises},n.prototype.getQueueLength=function(){return this.queue.length},n.prototype._dequeue=function(){var t=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var n,r=this.queue.shift();if(!r)return this.options.onEmpty&&this.options.onEmpty(),!1;try{this.pendingPromises++,(n=r.promiseGenerator(),n&&"function"==typeof n.then?n:new e((function(e){e(n)}))).then((function(e){t.pendingPromises--,r.resolve(e),t._dequeue()}),(function(e){t.pendingPromises--,r.reject(e),t._dequeue()}),(function(e){r.notify(e)}))}catch(e){t.pendingPromises--,r.reject(e),t._dequeue()}return!0},n}))},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=function(){function e(e){this.wishlistService=e}return e.prototype.addFavourite=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.wishlistService.addFavourite(e)];case 1:return n.sent(),[3,3];case 2:if((t=n.sent())instanceof s.IncorrectWishlistState||t instanceof s.WishlistNotFound)return[2,this.wishlistService.addFavourite(e)];throw t;case 3:return[2]}}))}))},e.prototype.removeFavourite=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.wishlistService.removeFavourite(e)];case 1:return n.sent(),[3,3];case 2:if((t=n.sent())instanceof s.IncorrectWishlistState)return[2,this.wishlistService.removeFavourite(e)];throw t;case 3:return[2]}}))}))},e.prototype.getWishlist=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){return[2,this.wishlistService.getWishlist()]}))}))},e.prototype.setOrder=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(n){return[2,this.wishlistService.setOrder(e,t)]}))}))},e}();t.RetryCommandWishlistService=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(95),s=function(){function e(e,t){this.eventAggregationService=e,this.wishlistCache=t}return e.prototype.initialize=function(){this.eventAggregationService.subscribeToWebSocketEvent(r.FavouriteAdded.eventName,new i.WebSocketFavouriteAddedSubscriber(this.eventAggregationService,this.wishlistCache))},e}();t.WebSocketFavouriteAddedAdapter=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=function(){function e(e,t){this.eventAggregationService=e,this.wishlistCache=t}return e.prototype.notify=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.wishlistCache.clearCache()];case 1:return t.sent(),this.eventAggregationService.publishFavouriteAddedEvent(new s.FavouriteAdded(e.userId,e.studyId,e.eventId,new Date(e.dateAdded))),[2]}}))}))},e}();t.WebSocketFavouriteAddedSubscriber=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(97),s=function(){function e(e,t){this.eventAggregationService=e,this.wishlistCache=t}return e.prototype.initialize=function(){this.eventAggregationService.subscribeToWebSocketEvent(r.FavouriteRemoved.eventName,new i.WebSocketFavouriteRemovedSubscriber(this.eventAggregationService,this.wishlistCache))},e}();t.WebSocketFavouriteRemovedAdapter=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=function(){function e(e,t){this.eventAggregationService=e,this.wishlistCache=t}return e.prototype.notify=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.removeFavouriteToCachedWishlist(e)];case 1:return t.sent(),this.eventAggregationService.publishFavouriteRemovedEvent(new s.FavouriteRemoved(e.userId,e.studyId,e.eventId,new Date(e.dateRemoved))),[2]}}))}))},e.prototype.removeFavouriteToCachedWishlist=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.wishlistCache.getWishlist()];case 1:return(t=n.sent())?(t.removeFavourite(e.studyId),[4,this.wishlistCache.setWishlist(t)]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},e}();t.WebSocketFavouriteRemovedSubscriber=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(99),s=function(){function e(e,t){this.eventAggregationService=e,this.wishlistCache=t}return e.prototype.initialize=function(){this.eventAggregationService.subscribeToWebSocketEvent(r.WishlistOrderChanged.eventName,new i.WebsocketWishlistOrderChangedSubscriber(this.eventAggregationService,this.wishlistCache))},e}();t.WebsocketWishlistOrderChangedAdapter=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=function(){function e(e,t){this.eventAggregationService=e,this.wishlistCache=t}return e.prototype.notify=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.setOrderOnCachedWishlist(e)];case 1:return t.sent(),this.eventAggregationService.publishWishlistOrderChangedEvent(new s.WishlistOrderChanged(e.userId,e.targetStudyId,e.referenceStudyId,e.eventId,new Date(e.dateChanged))),[2]}}))}))},e.prototype.setOrderOnCachedWishlist=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return[4,this.wishlistCache.getWishlist()];case 1:return(t=n.sent())?(t.changeOrder(e.targetStudyId,e.referenceStudyId),[4,this.wishlistCache.setWishlist(t)]):[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},e}();t.WebsocketWishlistOrderChangedSubscriber=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=function(){function e(e){this.eventAggregationService=e}return e.prototype.emit=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:switch(t.constructor){case s.FavouriteAdded:return[3,1];case s.FavouriteRemoved:return[3,3];case s.WishlistOrderChanged:return[3,5]}return[3,7];case 1:return[4,this.eventAggregationService.publishFavouriteAddedEvent(t)];case 2:return e.sent(),[3,8];case 3:return[4,this.eventAggregationService.publishFavouriteRemovedEvent(t)];case 4:return e.sent(),[3,8];case 5:return[4,this.eventAggregationService.publishWishlistOrderChangedEvent(t)];case 6:return e.sent(),[3,8];case 7:e.label=8;case 8:return[2]}}))}))},e}();t.EventAggregationServiceEventEmitter=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),o=n(13),u=function(){function e(e){this.localStorageDriver=e,this.localStorageKey="local-wishlist"}return e.prototype.addFavourite=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.saveWishlist(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.removeFavourite=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.saveWishlist(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.setWishlistOrder=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.saveWishlist(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.retrieveByUserId=function(e){return r(this,void 0,void 0,(function(){var e,t;return i(this,(function(n){switch(n.label){case 0:return[4,this.localStorageDriver.get(this.localStorageKey)];case 1:return""===(e=n.sent())||null===e||null===(t=JSON.parse(e))||void 0===t.userId?[2,null]:[2,o.WishlistFactory.translateSerializedWishlist(t)]}}))}))},e.prototype.changeUserId=function(e,t){return r(this,void 0,void 0,(function(){return i(this,(function(e){throw new Error("Not available on local wishlist")}))}))},e.prototype.createWishlist=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=new s.Wishlist(e),[4,this.saveWishlist(t)];case 1:return n.sent(),[2,t]}}))}))},e.prototype.removeWishlist=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.localStorageDriver.remove(this.localStorageKey)];case 1:return e.sent(),[2]}}))}))},e.prototype.saveWishlist=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.localStorageDriver.set(this.localStorageKey,JSON.stringify(e),1e12)];case 1:return t.sent(),[2]}}))}))},e}();t.LocalWishlistRepository=u},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(13),o=function(){function e(e){this.localStorageDriver=e,this.wishlist=null,this.storageKey="cached-remote-wishlist",this.cacheTTL=3600}return e.prototype.setWishlist=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.wishlist=e,[4,this.localStorageDriver.set(this.storageKey,JSON.stringify(this.wishlist),this.cacheTTL)];case 1:return t.sent(),[2]}}))}))},e.prototype.getWishlist=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return null!==this.wishlist?[3,2]:[4,this.localStorageDriver.get(this.storageKey)];case 1:if(""===(e=t.sent())||null===e)return[2,null];this.wishlist=s.WishlistFactory.translateSerializedWishlist(JSON.parse(e)),t.label=2;case 2:return[2,this.wishlist]}}))}))},e.prototype.clearCache=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return this.wishlist=null,[4,this.localStorageDriver.remove(this.storageKey)];case 1:return e.sent(),[2]}}))}))},e}();t.WishlistCache=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(5),s=n(104),o=n(105),u=n(107),a=n(109);window.Student=new a.Student(new u.StudentapiDriver(r.default.studentApiBaseUrl,window.AuthController,i.default,s.default),new o.ServicelayerDriver(r.default.serviceLayerBaseUrl,window.AuthController,i.default,s.default),s.default)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=n(19),s=n(1),o={environment:s.default.stage?s.default.stage:"dev",team:"xm",product:"StudentJS",category:"Profile"},u=new i.default(o);t.default=function(e,t){if(void 0===t&&(t={}),function(e){void 0===e.action&&(e.action=r.Actions.General),void 0===e.label&&(e.label=r.Labels.JSError),void 0===e.tags&&(e.tags=[r.Tags.Error])}(t),e){if(e instanceof Error){var n=e.name,i=e.message,s=e.stack;t.eventData=JSON.stringify({name:n,message:i,stack:s})}else t.eventData="object"==typeof e?JSON.stringify(e):"string"==typeof e?e:e.toString();t.payload&&(t.payload=JSON.stringify(t.payload),t.eventData.toLowerCase().includes("password")||t.payload.toLowerCase().includes("password")||(t.eventData+=t.payload),delete t.payload)}throw u.track(t),e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=n(106),s=n(9),o=function(){function e(e,t,n,r){this.retrievingFavourites=null,this.baseUrl=e,this.authController=t,this.fetch=n,this.countries={},this.disciplines={},this.studies={},this.organisations={},this.trackError=r}return e.prototype.clearCache=function(e){void 0===e&&(e="");var t=!0;switch(e){case"countries":this.countries={};break;case"disciplines":this.disciplines={};break;case"interests":this.countries={},this.disciplines={};break;default:t=!1}return t},e.prototype.addResourceType=function(e,t){return t.map((function(t){return t.type=e,t}))},e.prototype.getDisciplines=function(e){return this.getResources("disciplines",e)},e.prototype.getInterests=function(e,t){return e=e===i.InterestType.Country?"countries":"disciplines",this.getResources(e,t)},e.prototype.getResources=function(e,t){var n=this,r=this.getResourceCacheState(e,t),i=r.cached,o=r.notCached;return 0===o.length?Promise.resolve(this.mergeResourcesFromCacheWithNew(e,i,[])):this.sendRequest(s.RestCallType.GET,"/"+e+"?ids="+o.join(",")).then((function(t){return Array.isArray(t)?(t.forEach((function(t){n[e][t.id]=t})),n.mergeResourcesFromCacheWithNew(e,i,t)):[]}))},e.prototype.getResourceCacheState=function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){n.isResourceInCache(e,t)?r.push(t):i.push(t)})),{cached:r,notCached:i}},e.prototype.mergeResourcesFromCacheWithNew=function(e,t,n){var r=this,i=[];return t.forEach((function(t){i.push(r[e][t.toString()])})),i=i.concat(n)},e.prototype.isResourceInCache=function(e,t){return void 0!==Object.keys(this[e]).find((function(e){return e===t.toString()}))},e.prototype.sendRequest=function(e,t,n){var i=this;return void 0===n&&(n=null),this.authController.getAccessToken().then((function(o){var u={method:e};return u.headers={"Content-Type":"application/json",Authorization:o},u.credentials="omit",e.toUpperCase()!==s.RestCallType.GET&&n&&(u.body=JSON.stringify(n)),i.fetch(i.baseUrl+t,u).then((function(e){return e.json()})).catch((function(e){return i.trackError(e,{action:r.Actions.SLRequest,label:r.Labels.SLError})}))})).catch((function(e){return i.trackError(e,{action:r.Actions.JWTAuth,label:r.Labels.JWTAuthError})}))},e}();t.ServicelayerDriver=o},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.InterestType||(t.InterestType={})).Country="country",r.Discipline="discipline"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(14),i=n(108),s=n(9),o=function(){function e(e,t,n,r){this.baseUrl=e,this.authController=t,this.fetch=n,this.trackError=r}return e.prototype.getInterests=function(t){var n=e.getInterestFieldName(t);return this.sendRequest(s.RestCallType.GET,"/data?scope="+n,{}).then((function(e){return null==e[n]?[]:e[n]}))},e.prototype.addInterests=function(t,n){var r=e.getInterestFieldName(t),i={};return i[r+"_add"]=n,this.sendRequest(s.RestCallType.PATCH,"/data",i).then((function(e){return e[r]}))},e.prototype.removeInterests=function(t,n){var r=e.getInterestFieldName(t),i={};return i[r+"_remove"]=n,this.sendRequest(s.RestCallType.PATCH,"/data",i).then((function(e){return e[r]}))},e.prototype.removeDisciplines=function(e){var t={disciplines_remove:e};return this.sendRequest(s.RestCallType.PATCH,"/data",t).then((function(e){return e.disciplines}))},e.prototype.addDisciplines=function(e){var t={disciplines_add:e};return this.sendRequest(s.RestCallType.PATCH,"/data",t).then((function(e){return e.disciplines}))},e.prototype.getDisciplines=function(){return this.sendRequest(s.RestCallType.GET,"/data?scope=disciplines",{}).then((function(e){return null==e.disciplines?[]:e.disciplines}))},e.prototype.sendRequest=function(e,t,n){var o=this;return this.authController.getAccessToken().then((function(i){var u={method:e,headers:{"Content-Type":"application/json",Authorization:i}};e.toUpperCase()!==s.RestCallType.GET&&n&&(u.body=JSON.stringify(n));var a=!1,c=o.baseUrl+t,l={action:r.Actions.StudentsAPIRequest,label:r.Labels.StudentsAPIError,payload:{fetchUrl:c,options:u}};return o.fetch(c,u).then((function(e){return a=e.ok,e.json()})).then((function(e){return a||o.trackError(e,l),e})).catch((function(e){return o.trackError(e,l)}))})).catch((function(e){throw e instanceof i.default&&o.trackError(e,{action:r.Actions.JWTAuth,label:r.Labels.JWTAuthError}),e}))},e.prototype.patchData=function(e){return this.sendRequest(s.RestCallType.PATCH,"/data",e)},e.prototype.getData=function(e){return this.sendRequest(s.RestCallType.GET,"/data?scope="+e,{})},e.prototype.confirmForgotPassword=function(e,t){var n=this;return this.authController.getEmail().then((function(r){return n.sendRequest(s.RestCallType.PATCH,"/forgot-password",{ConfirmationCode:e,Password:t,Username:r})}))},e.prototype.disableAccount=function(){return this.sendRequest(s.RestCallType.DELETE,"/disable-account",{})},e.prototype.changePassword=function(e,t,n){return this.sendRequest(s.RestCallType.PATCH,"/change-password",{oldPassword:e,password:t,passwordConfirmation:n})},e.getInterestFieldName=function(e){if("country"===e)return"interests_countries";if("discipline"===e)return"interests_disciplines";throw new Error("Invalid interest type only country and discipline supported")},e}();t.StudentapiDriver=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){this.message=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(110),i=n(111),s=n(112),o=n(113),u=n(114),a=function(){function e(e,t,n){this.studentAPI=e,this.serviceLayer=t,this.readyCallbacks=[],this.interests={},this.readyFlag=!1,this.trackError=n}return e.prototype.ready=function(e){this.readyCallbacks.push(e),this.readyFlag&&this.notifyReadyCallbacks()},e.prototype.notifyReadyCallbacks=function(){this.readyCallbacks.shift()(this)},e.prototype.clearCache=function(){this.clearInterestsCache()},e}();t.Student=a,r.applyMixins(a,[u.Interests,s.Data,o.Disciplines,i.Account])},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.applyMixins=function(e,t){t.forEach((function(t){Object.getOwnPropertyNames(t.prototype).forEach((function(n){e.prototype[n]=t.prototype[n]}))}))}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.confirmForgotPassword=function(e,t){return this.studentAPI.confirmForgotPassword(e,t)},e.prototype.disableAccount=function(){return this.studentAPI.disableAccount()},e.prototype.changePassword=function(e,t,n){return this.studentAPI.changePassword(e,t,n)},e}();t.Account=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getScope=function(e){return this.studentAPI.getData(e)},e.prototype.getScopes=function(e){return this.getScope(e.join(","))},e.prototype.setValue=function(e,t){var n={};return n[e]=t,this.studentAPI.patchData(n)},e.prototype.setValues=function(e){return this.studentAPI.patchData(e)},e.prototype.setGPA=function(e,t){var n,r={gpa:(n={},n[e]=t,n.current_type=e,n)};return this.studentAPI.patchData(r)},e.prototype.setName=function(e){var t,n,r=e.indexOf(" ",0);-1!==r?(t=e.substring(0,r),n=e.substring(r).trim()):(t=e,n=null);var i={name:e,first_name:t,last_name:n};return this.studentAPI.patchData(i)},e}();t.Data=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.addDisciplines=function(e){var t=this;return this.studentAPI.addDisciplines(e).then((function(e){return t.disciplines=e,e}))},e.prototype.removeDisciplines=function(e){var t=this;return this.studentAPI.removeDisciplines(e).then((function(e){return t.disciplines=e,t.disciplines}))},e.prototype.getDisciplines=function(){var e=this;return new Promise((function(t,n){if(void 0===e.disciplines||!Array.isArray(e.disciplines))return e.studentAPI.getDisciplines().then((function(n){e.disciplines=null===n?[]:n,t(e.disciplines)}));t(e.disciplines)}))},e.prototype.getDisciplinesData=function(e){var t=this;return this.getDisciplines().then((function(e){return Array.isArray(e)&&e.length>0?t.serviceLayer.getDisciplines(e):[]}))},e}();t.Disciplines=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.clearInterestsCache=function(){this.interests={},this.serviceLayer.clearCache("interests")},e.prototype.addInterests=function(e,t){var n=this;return this.studentAPI.addInterests(e,t).then((function(t){return n.interests[e]=t,t}))},e.prototype.removeInterests=function(e,t){var n=this;return this.studentAPI.removeInterests(e,t).then((function(t){return n.interests[e]=t,t}))},e.prototype.getInterestsData=function(e){var t=this;return this.getInterests(e).then((function(n){return Array.isArray(n)&&n.length>0?t.serviceLayer.getInterests(e,n):[]}))},e.prototype.getInterests=function(e){var t=this;return new Promise((function(n,r){return void 0===t.interests[e]?t.studentAPI.getInterests(e).then((function(r){return Array.isArray(r)&&r.length>0?(t.interests[e]=r,n(r)):(t.interests[e]=[],n([]))})):n(t.interests[e])}))},e}();t.Interests=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}},s=this;Object.defineProperty(t,"__esModule",{value:!0});var o=n(1),u=n(5),a=n(3),c=n(116),l=n(121),h=n(122),f=n(126),d=n(127),p=n(128),y=n(132),v=n(137),g=n(139),b=n(7),w=n(140),m=new l.WebSocketGateway(""+o.default.wssEndpoint),S=new c.EventAggregationService(m),_=new w.TokenService(o.default.tokenServiceBaseUrl),P=new p.TokenBasedSessionFactory(S,_),E=new y.TokenBasedSessionRepositoryFactory(S,P,o.default).createByBrowserNavigator(navigator),O=new v.TokenBasedSessionService(E,S,_),R=new f.StudentapiDriver(o.default.studentApiBaseUrl,u.default),k=new h.default(O,R,S,new d.BrowserSessionStorage),C=new Date;function T(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return t=P.create(e),[4,O.setSession(t)];case 1:return n.sent(),[2]}}))}))}function x(){var e=new URL(window.location).searchParams.get("refreshToken");null!==e&&T(new b.Credentials(null,e))}m.EventAggregationService=S,window.AuthController=k,window.EventAggregationService=S,window.SessionService=O,window.SessionFactory=P,S.subscribeToSessionServiceReadyEvent(new a.CallbackSubscriber((function(e){return r(s,void 0,void 0,(function(){return i(this,(function(t){return"complete"===document.readyState?x():document.addEventListener("readystatechange",(function(e){"complete"===e.target.readyState&&x()})),m.initialize(e),[2]}))}))})));var A=null;function I(){null!==A&&window.snowplow("trackStructEvent","SessionService","initializing","completed",null,A.getTime()-C.getTime())}S.subscribeToSessionServiceReadyEvent(new a.CallbackSubscriber((function(){if(void 0===window.snowplow)return null;A=new Date,window.snowplow((function(){Object.keys(this).join("|").includes("cf7_")&&I(),document.addEventListener("DataTrackerReady",(function(){I()}))}))}))),document.addEventListener("student_logged_in",(function(e){T(e.detail)})),window.addEventListener("storage",(function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:if("SessionService/credentials"!==e.key)return[3,4];r.label=1;case 1:return r.trys.push([1,3,,4]),t=JSON.parse(e.newValue),n=JSON.parse(t.data),[4,O.getSession()];case 2:return null!==r.sent()?[2]:(T(n),[3,4]);case 3:return r.sent(),[3,4];case 4:return[2]}}))}))})),k.subscribe((function(e,t){return r(s,void 0,void 0,(function(){var e,n,r;return i(this,(function(i){switch(i.label){case 0:return!0!==t.LoggedInStatus||void 0===window.ga?[3,2]:(n=(e=window).ga,r=["set","userId"],[4,k.getIdentityId()]);case 1:n.apply(e,r.concat([i.sent()])),i.label=2;case 2:return[2]}}))}))})),S.subscribeToSessionServiceReadyEvent(new g.RollbarIdentitySubscriber(S)),k.initialize(),O.initialize(),E.initialize()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(36),i=n(118),s=n(119),o=n(120),u=function(){function e(e){this.webSocketGateway=e,this.sessionCreated=new i.EventEmitter,this.sessionRefreshed=new i.EventEmitter,this.sessionDestroyed=new i.EventEmitter,this.sessionServiceReady=new i.EventEmitter,this.sessionRepositoryReady=new i.EventEmitter,this.wishlistServiceReady=new i.EventEmitter,this.favouriteAdded=new i.EventEmitter,this.favouriteRemoved=new i.EventEmitter,this.wishlistOrderChanged=new i.EventEmitter,this.groupEventEmitter=new s.GroupEventEmitter}return e.prototype.subscribeToSessionCreatedEvent=function(e){this.sessionCreated.subscribe(e)},e.prototype.publishSessionCreatedEvent=function(e){this.sessionCreated.notify(new r.SessionCreatedEvent(e))},e.prototype.subscribeToSessionRefreshedEvent=function(e){this.sessionRefreshed.subscribe(e)},e.prototype.publishSessionRefreshedEvent=function(){this.sessionRefreshed.notify()},e.prototype.subscribeToSessionDestroyedEvent=function(e){this.sessionDestroyed.subscribe(e)},e.prototype.publishSessionDestroyedEvent=function(){this.sessionDestroyed.notify()},e.prototype.subscribeToSessionServiceReadyEvent=function(e){this.sessionServiceReady.subscribe(e)},e.prototype.publishSessionServiceReadyEvent=function(e){this.sessionServiceReady.notify(e)},e.prototype.subscribeToSessionRepositoryReadyEvent=function(e){this.sessionRepositoryReady.subscribe(e)},e.prototype.publishSessionRepositoryReadyEvent=function(){this.sessionRepositoryReady.notify()},e.prototype.subscribeToWishlistServiceReadyEvent=function(e){this.wishlistServiceReady.subscribe(e)},e.prototype.publishWishlistServiceReadyEvent=function(e){this.wishlistServiceReady.notify(e)},e.prototype.subscribeToFavouriteAddedEvent=function(e){this.favouriteAdded.subscribe(e)},e.prototype.publishFavouriteAddedEvent=function(e){this.favouriteAdded.notify(e)},e.prototype.subscribeToFavouriteRemovedEvent=function(e){this.favouriteRemoved.subscribe(e)},e.prototype.publishFavouriteRemovedEvent=function(e){this.favouriteRemoved.notify(e)},e.prototype.subscribeToWishlistOrderChangedEvent=function(e){this.wishlistOrderChanged.subscribe(e)},e.prototype.publishWishlistOrderChangedEvent=function(e){this.wishlistOrderChanged.notify(e)},e.prototype.subscribeToWebSocketEvent=function(e,t){this.webSocketGateway.addSubscriber(new o.WebSocketGatewaySubscriber(e,t))},e.prototype.subscribeTo=function(e,t){this.groupEventEmitter.subscribe(e,t)},e.prototype.publishTo=function(e,t){this.groupEventEmitter.notify(e,t)},e}();t.EventAggregationService=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionCreatedEvent=function(e){this.timestamp=new Date,this.session=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.subscribers=[]}return e.prototype.subscribe=function(e){this.subscribers.push(e)},e.prototype.notify=function(e){this.subscribers.forEach((function(t){return t.notify(e)}))},e}();t.EventEmitter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.subscribers=new Map}return e.prototype.subscribe=function(e,t){var n=this.subscribers.get(e)||[];n.push(t),this.subscribers.set(e,n)},e.prototype.notify=function(e,t){var n=this.subscribers.get(e);n&&n.forEach((function(e){return e.notify(t)}))},e}();t.GroupEventEmitter=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){this.eventType=e,this.handler=t}return e.prototype.canHandle=function(e){return"string"==typeof this.eventType?this.eventType.toLowerCase()===e.toLowerCase():this.eventType.test(e)},e.prototype.handle=function(e){this.handler.notify(e)},e}();t.WebSocketGatewaySubscriber=r},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(3),o=n(8),u=function(){function e(e){this.wssEndpoint=e,this.subscribers=[]}return Object.defineProperty(e.prototype,"EventAggregationService",{set:function(e){this.eventAggregationService=e},enumerable:!0,configurable:!0}),e.prototype.initialize=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return this.sessionService=e,[4,this.isUserLoggedIn()];case 1:return t.sent()?[4,this.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:return this.addEventAggregationEventListeners(),[2]}}))}))},e.prototype.connect=function(){return r(this,void 0,void 0,(function(){var e,t,n;return i(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.getAccessToken()];case 1:return e=r.sent(),t=window.location&&window.location.href?encodeURIComponent(window.location.href):"",this.socket=new WebSocket(this.wssEndpoint+"?token="+e+"&url="+t),this.addWebsocketEventListeners(),[3,3];case 2:if(!((n=r.sent())instanceof o.RefreshTokenError))throw n;return this.eventAggregationService.publishSessionDestroyedEvent(),[3,3];case 3:return[2]}}))}))},e.prototype.addSubscriber=function(e){this.subscribers.push(e)},e.prototype.isUserLoggedIn=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.sessionService.getSession()];case 1:return[2,null!==e.sent()]}}))}))},e.prototype.addEventAggregationEventListeners=function(){var e=this;this.eventAggregationService.subscribeToSessionCreatedEvent(new s.CallbackSubscriber((function(){return e.connect()})))},e.prototype.addWebsocketEventListeners=function(){var e=this;this.socket.addEventListener("message",(function(t){e.onMessage(JSON.parse(t.data))})),this.socket.addEventListener("close",(function(){e.reconnect()}))},e.prototype.reconnect=function(){var e=this;setTimeout((function(){return e.connect()}),5e3)},e.prototype.getAccessToken=function(){return r(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.sessionService.getSession()];case 1:return[2,e.sent().getAccessToken()]}}))}))},e.prototype.onMessage=function(e){this.subscribers.filter((function(t){return t.canHandle(e.eventType)})).forEach((function(t){return t.handle(e)}))},e}();t.WebSocketGateway=u},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),a=n(6),c=n(124),l=n(15),h=n(125),f=function(){function e(e,t,n,r){this.browserSessionStorageKey="LoggedInStatus",this.isLoggedInStatus=!1,this.sessionService=e,this.studentApiDriver=t,this.eventAggregationService=n,this.browserSessionStorage=r,this.deferred=new l.Deferred,this.subscribers=[]}return e.prototype.initialize=function(){var e=this;this.eventAggregationService.subscribeToSessionServiceReadyEvent(new u.CallbackSubscriber((function(){return e.onSessionServiceReady()}))),this.eventAggregationService.subscribeToSessionCreatedEvent(new u.CallbackSubscriber((function(){return e.onSessionCreated()}))),this.eventAggregationService.subscribeToSessionDestroyedEvent(new u.CallbackSubscriber((function(){return e.onSessionDestroyed()})))},e.prototype.onSessionServiceReady=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.sessionService.getSession()];case 1:return e=t.sent(),this.setLoginStatus(null!==e),this.deferred.open(),[2]}}))}))},e.prototype.onSessionCreated=function(){this.setLoginStatus(!0),this.notifySubscribers()},e.prototype.onSessionDestroyed=function(){this.setLoginStatus(!1),this.notifySubscribers()},e.prototype.notifySubscribers=function(){var e=this;this.subscribers.forEach((function(t){t.notify(null,{LoggedInStatus:e.isLoggedInStatus})}))},e.prototype.subscribe=function(e){return s(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.deferred.untilOpen()];case 1:return n.sent(),(t=new c.CallbackSubscriberLegacy(e)).notify(null,{LoggedInStatus:this.isLoggedInStatus}),this.subscribers.push(t),[2]}}))}))},e.prototype.getTokenSession=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return[4,this.deferred.untilOpen()];case 1:return t.sent(),[4,this.sessionService.getSession()];case 2:if(null===(e=t.sent()))throw new h.default("No session exists");return[2,e]}}))}))},e.prototype.forgotPassword=function(e){return s(this,void 0,void 0,(function(){return o(this,(function(t){return[2,this.studentApiDriver.resetPassword(e)]}))}))},e.prototype.sessionLogout=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.deferred.untilOpen()];case 1:return e.sent(),[4,this.getTokenSession()];case 2:return[2,e.sent().destroy()]}}))}))},e.prototype.subjectLogout=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.deferred.untilOpen()];case 1:return e.sent(),[2,this.sessionService.globalLogout()]}}))}))},e.prototype.getAccessToken=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.deferred.untilOpen()];case 1:return e.sent(),[4,this.getTokenSession()];case 2:return[2,e.sent().getAccessToken()]}}))}))},e.prototype.getIdentityId=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.deferred.untilOpen()];case 1:return e.sent(),[4,this.getTokenSession()];case 2:return[2,e.sent().getUser().identityId]}}))}))},e.prototype.getEmail=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.deferred.untilOpen()];case 1:return e.sent(),[4,this.getTokenSession()];case 2:return[2,e.sent().getUser().email]}}))}))},e.prototype.isLoggedIn=function(){return"true"===this.browserSessionStorage.getItem(this.browserSessionStorageKey)},e.prototype.setLoginStatus=function(e){this.isLoggedInStatus=e,this.browserSessionStorage.setItem(this.browserSessionStorageKey,this.isLoggedInStatus)},r([a.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"initialize",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"onSessionServiceReady",null),r([a.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"onSessionCreated",null),r([a.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"onSessionDestroyed",null),r([a.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"notifySubscribers",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[Function]),i("design:returntype",Promise)],e.prototype,"subscribe",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],e.prototype,"forgotPassword",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"sessionLogout",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"subjectLogout",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getAccessToken",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getIdentityId",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getEmail",null),r([a.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"isLoggedIn",null),e}();t.default=f},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e){this.callback=e}return e.prototype.notify=function(e,t){try{this.callback(e,t)}catch(e){}},e}();t.CallbackSubscriberLegacy=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e){this.message=e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(9),i=function(){function e(e,t){this.baseUrl=e,this.fetch=t}return e.prototype.resetPassword=function(e){return this.sendRequest(r.RestCallType.POST,"/forgot-password",{Username:e})},e.prototype.sendRequest=function(e,t,n){var i={method:e,headers:{"Content-Type":"application/json"}};return e.toUpperCase()!==r.RestCallType.GET&&n&&(i.body=JSON.stringify(n)),this.fetch(this.baseUrl+t,i).then((function(e){return e.json()}))},e}();t.StudentapiDriver=i},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){}return e.prototype.getItem=function(e){try{return window.sessionStorage.getItem(e)}catch(e){return null}},e.prototype.setItem=function(e,t){try{window.sessionStorage.setItem(e,t)}catch(e){}},e}();t.BrowserSessionStorage=r},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)};Object.defineProperty(t,"__esModule",{value:!0});var s=n(6),o=n(129),u=n(7),a=function(){function e(e,t){this.eventAggregationService=e,this.tokenService=t}return e.prototype.create=function(e){var t=new o.TokenBasedSession(this.tokenService,this.eventAggregationService);return t.setCredentials(e),t},r([s.CatchReportException,i("design:type",Function),i("design:paramtypes",[u.Credentials]),i("design:returntype",Object)],e.prototype,"create",null),e}();t.TokenBasedSessionFactory=a},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(15),a=n(6),c=n(7),l=n(8),h=n(37),f=n(130),d=n(131),p=function(){function e(e,t){this.user=null,this.credentials=null,this.deferred=new u.Deferred,this.serverTime=new d.ServerTime,this.isUseablePromise=null,this.tokenService=e,this.eventAggregationService=t,this.deferred.open()}return e.prototype.getAccessToken=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.deferred.untilOpen()];case 1:return e.sent(),this.deferred.close(),[4,this.shouldRefresh()];case 2:return e.sent()?[4,this.refreshCredentials()]:(this.deferred.open(),[2,this.credentials.accessToken]);case 3:return[2,e.sent().accessToken]}}))}))},e.prototype.getRefreshToken=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.credentials.refreshToken]}))}))},e.prototype.destroy=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,,3,4]),[4,this.getAccessToken()];case 1:return e=t.sent(),[4,this.tokenService.logoutSession(e)];case 2:return t.sent(),[3,4];case 3:return this.eventAggregationService.publishSessionDestroyedEvent(),[7];case 4:return[2]}}))}))},e.prototype.getUser=function(){return this.user},e.prototype.getCredentials=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){return[2,this.credentials]}))}))},e.prototype.setCredentials=function(e){if(!e.refreshToken)throw this.eventAggregationService.publishSessionDestroyedEvent(),new l.RefreshTokenError("Not a valid refresh token.");if(null!==e.accessToken){var t=this.getTokenPayload(e.accessToken);this.setUser(t)}this.credentials=e},e.prototype.setUser=function(e){this.user=new f.Student(e.sub,e.email)},e.prototype.isUsable=function(){var e=this;return null!==this.isUseablePromise||(this.isUseablePromise=new Promise((function(t,n){return s(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.shouldRefresh()];case 1:if(!e.sent())return[2,t(!0)];e.label=2;case 2:return e.trys.push([2,4,,5]),[4,this.refreshCredentials()];case 3:return e.sent(),[3,5];case 4:return e.sent(),t(!1),[3,5];case 5:return t(!0),[2]}}))}))}))),this.isUseablePromise},e.prototype.refreshCredentials=function(){return s(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,this.tokenService.refreshCredentials(this.credentials.refreshToken)];case 1:return e=n.sent(),this.setCredentials(e),this.eventAggregationService.publishSessionRefreshedEvent(),this.deferred.open(),[2,this.credentials];case 2:throw t=n.sent(),this.deferred.open(),t instanceof l.RefreshTokenError&&this.eventAggregationService.publishSessionDestroyedEvent(),t;case 3:return[2]}}))}))},e.prototype.shouldRefresh=function(){return s(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return null===this.credentials||null===this.credentials.accessToken?[2,!0]:(e=this.getTokenPayload(this.credentials.accessToken).exp-5,[4,this.serverTime.now()]);case 1:return t=n.sent(),[2,e<=t]}}))}))},e.prototype.getTokenPayload=function(e){void 0===e&&(e="");try{var t=e.split(".")[1].replace("-","+").replace("_","/");return JSON.parse(window.atob(t))}catch(e){throw new h.InvalidAccessTokenError("Not a valid JWT.")}},r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getAccessToken",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getRefreshToken",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"destroy",null),r([a.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Object)],e.prototype,"getUser",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getCredentials",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[c.Credentials]),i("design:returntype",void 0)],e.prototype,"setCredentials",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",void 0)],e.prototype,"setUser",null),r([a.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"isUsable",null),e}();t.TokenBasedSession=p},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Student=function(e,t){this.identityId=e,this.email=t}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(20),o=n(5),u=function(){function e(){this.cachedTime={time:null,offset:null},this.storage=new s.DataStorageDriver,this.storageKey="SessionService/CachedTime",this.apiEndpoint="https://worldtimeapi.org/api/timezone/Etc/GMT"}return Object.defineProperty(e.prototype,"fetch",{get:function(){return o.default},enumerable:!0,configurable:!0}),e.prototype.syncDate=function(){return r(this,void 0,void 0,(function(){var e,t,n,r;return i(this,(function(i){switch(i.label){case 0:return i.trys.push([0,3,,4]),[4,this.fetch(this.apiEndpoint,{})];case 1:return[4,i.sent().json()];case 2:return e=i.sent(),this.storeTimeInCache({time:e.unixtime,offset:Math.round(e.unixtime-this.getCurrentTime())}),[3,4];case 3:return i.sent(),this.storeTimeInCache({time:this.getCurrentTime(),offset:0}),[3,4];case 4:return t=this,r=(n=JSON).parse,[4,this.storage.get(this.storageKey)];case 5:return t.cachedTime=r.apply(n,[i.sent()]),[2]}}))}))},e.prototype.now=function(){return r(this,void 0,void 0,(function(){var e;return i(this,(function(t){switch(t.label){case 0:return[4,this.storage.get(this.storageKey)];case 1:return(e=t.sent())?[3,3]:[4,this.syncDate()];case 2:return t.sent(),[3,4];case 3:this.cachedTime=JSON.parse(e),t.label=4;case 4:return[2,this.getCurrentTime()+this.cachedTime.offset]}}))}))},e.prototype.storeTimeInCache=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.storage.set(this.storageKey,JSON.stringify(e),2592e3)];case 1:return t.sent(),[2]}}))}))},e.prototype.getCurrentTime=function(){return Math.round(Date.now()/1e3)},e}();t.ServerTime=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(133),i=function(){function e(e,t,n){this.eventAggregationService=e,this.tokenSessionFactory=t,this.config=n}return e.prototype.createByBrowserNavigator=function(e){var t=this.isSafari(e);return new r.TokenBasedSessionRepository(this.eventAggregationService,this.tokenSessionFactory,this.config.hubUrl,t)},e.prototype.isSafari=function(e){return/Safari/.test(e.userAgent)&&(/Apple Computer/.test(e.vendor)||/CriOS/.test(e.userAgent))},e}();t.TokenBasedSessionRepositoryFactory=i},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(12),a=n(16),c=n(6),l=n(37),h=n(134),f=n(135),d=n(7),p=n(136),y=function(){function e(e,t,n,r){void 0===r&&(r=!1),this.eventAggregationService=e,this.tokenSessionFactory=t,this.hubURL=n,this.isCrossDomainDisabled=r,this.localStorageKey="SessionService/credentials",this.crossStorageKey="credentials",this.localStorage=u.DataStorage,this.isCrossDomainStorageSuccessfullyInitialized=null}return e.prototype.initialize=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:this.isCrossDomainStorageSuccessfullyInitialized=this.initializeCrossDomainStorage(),e.label=1;case 1:return e.trys.push([1,3,,7]),[4,this.get(f.SessionStorageType.Local)];case 2:return e.sent(),[3,7];case 3:return e.sent(),[4,this.isCrossDomainStorageSuccessfullyInitialized];case 4:return e.sent()?[4,this.copySessionWhenExists()]:[3,6];case 5:e.sent(),e.label=6;case 6:return[3,7];case 7:return this.eventAggregationService.publishSessionRepositoryReadyEvent(),[2]}}))}))},e.prototype.copySessionWhenExists=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),[4,this.get(f.SessionStorageType.CrossDomain)];case 1:return e=t.sent(),[4,this.save(e)];case 2:case 3:return t.sent(),[3,4];case 4:return[2]}}))}))},e.prototype.initializeCrossDomainStorage=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:if(this.isCrossDomainDisabled)return[2,!1];e.label=1;case 1:return e.trys.push([1,3,,4]),this.crossStorageClient=this.getNewCrossStorageClient(this.hubURL),[4,this.crossStorageClient.onConnect()];case 2:return e.sent(),[2,!0];case 3:return e.sent(),this.trackFallbackError(),[2,!1];case 4:return[2]}}))}))},e.prototype.getNewCrossStorageClient=function(e){return new a.CrossStorageClient(e,{timeout:3e4})},e.prototype.trackFallbackError=function(){if(void 0===window.snowplow)return null;window.snowplow("trackStructEvent","SessionService","fallback","localStorage")},e.prototype.get=function(e){return void 0===e&&(e=f.SessionStorageType.Local),s(this,void 0,void 0,(function(){var t,n;return o(this,(function(r){switch(r.label){case 0:return[4,this.getSerializedCredentials(e)];case 1:if(null===(t=r.sent()))throw new p.SessionNotFoundError("There is no session in the session store");try{return n=JSON.parse(t),[2,this.tokenSessionFactory.create(n)]}catch(e){if(e instanceof l.InvalidAccessTokenError||e instanceof h.InvalidRefreshTokenError)throw e;throw new p.SessionNotFoundError(e.message)}return[2]}}))}))},e.prototype.getSerializedCredentials=function(e){return s(this,void 0,void 0,(function(){return o(this,(function(t){return e===f.SessionStorageType.Local?[2,this.localStorage.retrieve(this.localStorageKey)]:[2,this.crossStorageClient.get(this.crossStorageKey)]}))}))},e.prototype.save=function(e){return s(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,this.createSerializedCredentials(e)];case 1:return t=n.sent(),[4,this.storeSerializedCredentials(t)];case 2:return n.sent(),[2]}}))}))},e.prototype.storeSerializedCredentials=function(e){return s(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return t=15552e3,this.localStorage.store(this.localStorageKey,e,t),[4,this.isCrossDomainStorageSuccessfullyInitialized];case 1:return n.sent()?[4,this.crossStorageClient.set(this.crossStorageKey,e,t)]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))},e.prototype.createSerializedCredentials=function(e){return s(this,void 0,void 0,(function(){var t,n,r;return o(this,(function(i){switch(i.label){case 0:return n=d.Credentials.bind,[4,e.getAccessToken()];case 1:return r=[void 0,i.sent()],[4,e.getRefreshToken()];case 2:return t=new(n.apply(d.Credentials,r.concat([i.sent()]))),[2,JSON.stringify(t)]}}))}))},e.prototype.clear=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.localStorage.remove(this.localStorageKey),[4,this.isCrossDomainStorageSuccessfullyInitialized];case 1:return e.sent()?[4,this.crossStorageClient.del(this.crossStorageKey)]:[3,3];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},r([c.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"initialize",null),e}();t.TokenBasedSessionRepository=y},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidRefreshTokenError=function(){this.message="The token is not a valid refresh token."}},function(e,t,n){"use strict";var r;Object.defineProperty(t,"__esModule",{value:!0}),(r=t.SessionStorageType||(t.SessionStorageType={}))[r.CrossDomain=0]="CrossDomain",r[r.Local=1]="Local"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionNotFoundError=function(e){void 0===e&&(e=""),this.message=e}},function(e,t,n){"use strict";var r=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var u=e.length-1;u>=0;u--)(i=e[u])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),a=n(138),c=n(15),l=n(6),h=n(8),f=function(){function e(e,t,n){this.isReady=!1,this.session=null,this.tokenRepository=e,this.eventAggregationService=t,this.tokenService=n,this.deferred=new c.Deferred}return e.prototype.initialize=function(){this.eventAggregationService.subscribeToSessionRepositoryReadyEvent(this.onSessionRepositoryReady),this.eventAggregationService.subscribeToSessionDestroyedEvent(this.onSessionDestroyed),this.eventAggregationService.subscribeToSessionRefreshedEvent(this.onSessionRefreshed)},Object.defineProperty(e.prototype,"onSessionRepositoryReady",{get:function(){var e=this;return new u.CallbackSubscriber((function(){e.openSessionService()}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSessionRefreshed",{get:function(){var e=this;return new a.OnceCallbackSubscriber((function(){return s(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.saveRefreshedSession()];case 1:return e.sent(),[2]}}))}))}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"onSessionDestroyed",{get:function(){var e=this;return new u.CallbackSubscriber((function(){return s(e,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.clearSession()];case 1:return e.sent(),[2]}}))}))}))},enumerable:!0,configurable:!0}),e.prototype.getSession=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return e.trys.push([0,4,,5]),null!==this.session?[3,2]:[4,this.loadSession()];case 1:e.sent(),e.label=2;case 2:return[4,this.session];case 3:return[2,e.sent()];case 4:return e.sent(),[2,null];case 5:return[2]}}))}))},e.prototype.setSession=function(e){return s(this,void 0,void 0,(function(){return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),this.deferred.untilOpen(),this.session=e,[4,e.getAccessToken()];case 1:return t.sent(),[4,this.tokenRepository.save(e)];case 2:return t.sent(),this.eventAggregationService.publishSessionCreatedEvent(e),[3,4];case 3:return t.sent(),this.session=null,this.eventAggregationService.publishSessionDestroyedEvent(),[3,4];case 4:return[2]}}))}))},e.prototype.globalLogout=function(){return s(this,void 0,void 0,(function(){var e;return o(this,(function(t){switch(t.label){case 0:return t.trys.push([0,4,,5]),[4,this.tokenRepository.get()];case 1:return[4,t.sent().getAccessToken()];case 2:return e=t.sent(),[4,this.tokenService.logoutSubject(e)];case 3:return t.sent(),[3,5];case 4:return t.sent(),h.RefreshTokenError,[3,5];case 5:return this.eventAggregationService.publishSessionDestroyedEvent(),[2]}}))}))},e.prototype.openSessionService=function(){this.deferred.open(),this.isReady=!0,this.eventAggregationService.publishSessionServiceReadyEvent(this)},e.prototype.saveRefreshedSession=function(){return s(this,void 0,void 0,(function(){var e,t;return o(this,(function(n){switch(n.label){case 0:return t=(e=this.tokenRepository).save,[4,this.session];case 1:return[4,t.apply(e,[n.sent()])];case 2:return n.sent(),[2]}}))}))},e.prototype.clearSession=function(){return s(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return this.session=null,[4,this.tokenRepository.clear()];case 1:return e.sent(),[2]}}))}))},e.prototype.loadSession=function(){var e=this;null===this.session&&(this.session=new Promise((function(t,n){return s(e,void 0,void 0,(function(){var e,n;return o(this,(function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,this.tokenRepository.get()];case 1:return e=r.sent(),n=t,[4,e.isUsable()];case 2:return n.apply(void 0,[r.sent()?e:null]),[3,4];case 3:return r.sent(),t(null),[3,4];case 4:return[2]}}))}))})))},r([l.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"initialize",null),r([l.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"getSession",null),r([l.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[Object]),i("design:returntype",Promise)],e.prototype,"setSession",null),r([l.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"globalLogout",null),r([l.CatchReportException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"openSessionService",null),r([l.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"saveRefreshedSession",null),r([l.CatchReportAsyncException,i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",Promise)],e.prototype,"clearSession",null),e}();t.TokenBasedSessionService=f},function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=function(e){function t(t){var n=e.call(this,t)||this;return n.lastEventSent="",n}return i(t,e),t.prototype.notify=function(t){var n=JSON.stringify(t);this.lastEventSent!==n&&(this.lastEventSent=n,e.prototype.notify.call(this,t))},t}(n(3).CallbackSubscriber);t.OnceCallbackSubscriber=s},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s=n(36),o=function(){function e(e){this.eventAggregationService=e}return e.prototype.notify=function(e){return r(this,void 0,void 0,(function(){var t;return i(this,(function(n){switch(n.label){case 0:return e instanceof s.SessionCreatedEvent?[2,this.initializeRollbarIdentity(e.session)]:[4,e.getSession()];case 1:return null===(t=n.sent())?(this.eventAggregationService.subscribeToSessionCreatedEvent(this),[2]):(this.initializeRollbarIdentity(t),[2])}}))}))},e.prototype.initializeRollbarIdentity=function(e){"undefined"!=typeof Rollbar&&Rollbar.configure({payload:{person:{id:e.getUser().identityId}}})},e}();t.RollbarIdentitySubscriber=o},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,s){function o(e){try{a(r.next(e))}catch(e){s(e)}}function u(e){try{a(r.throw(e))}catch(e){s(e)}}function a(e){e.done?i(e.value):new n((function(t){t(e.value)})).then(o,u)}a((r=r.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var n,r,i,s,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return s={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function u(s){return function(u){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&s[0]?r.return:s[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,s[1])).done)return i;switch(r=0,i&&(s=[2&s[0],i.value]),s[0]){case 0:case 1:i=s;break;case 4:return o.label++,{value:s[1],done:!1};case 5:o.label++,r=s[1],s=[0];continue;case 7:s=o.ops.pop(),o.trys.pop();continue;default:if(!((i=(i=o.trys).length>0&&i[i.length-1])||6!==s[0]&&2!==s[0])){o=0;continue}if(3===s[0]&&(!i||s[1]>i[0]&&s[1]<i[3])){o.label=s[1];break}if(6===s[0]&&o.label<i[1]){o.label=i[1],i=s;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(s);break}i[2]&&o.ops.pop(),o.trys.pop();continue}s=t.call(e,o)}catch(e){s=[6,e],r=0}finally{n=i=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}};Object.defineProperty(t,"__esModule",{value:!0});var s,o=n(141),u=n(7),a=n(142),c=n(8);!function(e){e.Session="session",e.Subject="subject"}(s=t.LogoutMode||(t.LogoutMode={}));var l=function(){function e(e){this.baseUrl=e}return e.prototype.signRequest=function(e,t){e.headers.append("Authorization",t)},e.prototype.getRefreshTokenRequestOptions=function(e){var t=new o.Request(this.baseUrl+"/refresh",{method:"GET"});return this.signRequest(t,e),t},e.prototype.getLogoutTokenRequestOptions=function(e,t){var n=new o.Request(this.baseUrl+"/revoke?mode="+t,{method:"DELETE"});return this.signRequest(n,e),n},e.prototype.refreshCredentials=function(e){return r(this,void 0,void 0,(function(){var t,n;return i(this,(function(r){switch(r.label){case 0:return[4,this.fetch(this.getRefreshTokenRequestOptions(e))];case 1:return(t=r.sent()).ok?[4,t.json()]:[3,3];case 2:return n=r.sent(),[2,new u.Credentials(n.accessToken,n.refreshToken)];case 3:if(401===t.status)throw new c.RefreshTokenError("Refresh token unauthorized");r.label=4;case 4:throw new c.RefreshTokenError("Error while refreshing")}}))}))},e.prototype.logoutSession=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.fetch(this.getLogoutTokenRequestOptions(e,s.Session))];case 1:if(!t.sent().ok)throw new a.LogoutError;return[2]}}))}))},e.prototype.logoutSubject=function(e){return r(this,void 0,void 0,(function(){return i(this,(function(t){switch(t.label){case 0:return[4,this.fetch(this.getLogoutTokenRequestOptions(e,s.Subject))];case 1:if(!t.sent().ok)throw new a.LogoutError;return[2]}}))}))},e.prototype.fetch=function(e,t){return o.default(e,t)},e}();t.TokenService=l},function(e,t,n){"use strict";var r=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r)return r;throw new Error("unable to locate global object")}();e.exports=t=r.fetch,t.default=r.fetch.bind(r),t.Headers=r.Headers,t.Request=r.Request,t.Response=r.Response},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LogoutError=function(){this.message="There was a problem while logging out."}},,,function(e,t,n){n(115),n(103),n(38)}]);
//# sourceMappingURL=bundle.js.map